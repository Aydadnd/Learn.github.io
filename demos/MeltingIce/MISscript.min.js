function windowResized(){maxWidth=Math.min(.95*document.documentElement.clientWidth,1200),maxHeight=Math.min(.95*document.documentElement.clientHeight,1e3),minWidth=Math.max(600,.95*document.documentElement.clientWidth),minHeight=Math.max(500,.95*document.documentElement.clientHeight),clientWidth=Math.max(minWidth,maxWidth),clientHeight=Math.max(minHeight,maxHeight),clientWidth>1.2*clientHeight?clientWidth=1.2*clientHeight:clientHeight=clientWidth/1.2,getAreas(),$(".wrapper").css("width",clientWidth+"px"),$(".wrapper").css("height",clientHeight+"px"),$(".box").css("height",.42*clientHeight+"px"),$(".d").css("height",.58*clientHeight+"px");let t=.42*clientHeight;$(".btn-lg").css({height:.11*t+"px",width:.2*t+"px",fontSize:t/300+"rem"}),$(".btn-lg").css("line-height",.11*t+"px"),$(".b1").css("bottom",.13*clientHeight+"px"),$(".b2").css({right:.05*t+"px",bottom:.08*clientHeight+"px"}),$("#graphInfo").css({height:.11*t+"px",width:.45*t+"px",fontSize:t/300+"rem",bottom:.5*t+"px"}),$("#graphInfo").css("line-height",.11*t+"px"),$("#graphInfo").hide(),$(".graphChoose").css("top",35+(clientHeight-500)/500*50+"px"),$("input[type='radio']").css("margin-bottom",(clientHeight-500)/500*20+"px"),$(":root").css({"font-size":11+(clientWidth-600)/600*4+"px"}),graphFontSize=12+(clientWidth-600)/600*4,plot1.setAllFontProperties("Helvetica",color(0,0,0),graphFontSize),plot2.setAllFontProperties("Helvetica",color(0,0,0),graphFontSize);let e=$("#topLeft").width(),i=$("#topRight").width(),a=170;switch(panel1.setWidth(e),panel2.setWidth(i),panel1.setPosition(0,10),panel2.setPosition($("#bottomCenter").width()-i,10),panel3.setWidth(a),panel3.setPosition($("#bottomCenter").width()-170,.7*clientHeight-40),bkHeight=$("#beakersImg").height(),boxHeight=$("#topCenter").height(),fallDist=.6*bkHeight/boxHeight*100,clear(),showWhichGraph){case"1":plot1.setOuterDim(clientWidth-170,.54*clientHeight),plot1.setPos(10,0);break;case"2":plot2.setOuterDim(clientWidth-170,.54*clientHeight),plot2.setPos(10,0);break;case"3":plot1.setOuterDim(.5*clientWidth-85,.54*clientHeight),plot2.setOuterDim(.5*clientWidth-85,.54*clientHeight),plot2.setPos(.5*clientWidth-85,0)}resizeCanvas(clientWidth/.95,cnv.height=.54*clientHeight/.95),clear()}function init(){$("#startButton").on("click",startMelting),$("#resetButton").on("click",resetExperiment),$("input[name='whichGraph']").click(function(){showWhichGraph=$("input[name='whichGraph']:checked").val(),windowResized()}),showWhichGraph=$("input[name='whichGraph']:checked").val(),$("#stirBar1").hide(),$("#stirBar2").hide(),getAreas(),getNumBlocks()}function setup(){pixelDensity(HD),cnv=createCanvas(100,100),cnv.parent("bottomCenter"),plot1=new GPlot(this),plot1.setPos(10,0),plot1.setOuterDim(100,100),plot1.setYLim(0,1),plot1.getXAxis().getAxisLabel().setText("time (s)"),plot1.getYAxis().getAxisLabel().setText("mass of ice melted (g)"),plot1.getTitle().setText("mass of ice melted"),plot2=new GPlot(this),plot2.setPos(10,0),plot2.setOuterDim(100,100),plot2.setYLim(0,400),plot2.getXAxis().getAxisLabel().setText("time (s)"),plot2.getYAxis().getAxisLabel().setText("temperature (°C)"),plot2.getTitle().setText("temperature of blocks"),smooth()}function generateGraphPoints(){let t=stirFactor1*area1*numBlocks1/1e4,e=stirFactor2*area2*numBlocks2/1e4,a=initialTemp1,r=initialTemp2,o=icewaterTemp,n=heatCapacity1*mass1*numBlocks1,s=heatCapacity2*mass2*numBlocks2,l=waterHeatCap*waterMass,c=waterHeatFusion;iceMeltedVsTime1=`${n*(a-o)} * (1 - e^( ${-t/n} *t))/${c}`,iceMeltedVsTime2=`${s*(r-o)} * (1 - e^( ${-e/s} *t))/${c}`,sit1IceArray=functionToArray(iceMeltedVsTime1,["t",0,tMax,dt]),sit2IceArray=functionToArray(iceMeltedVsTime2,["t",0,tMax,dt]),tempVsTime1=`${o} + ${a-o} *e^( ${-t/n} *t)`,tempVsTime2=`${o} + ${r-o} *e^( ${-e/s} *t)`;let p=!1,h=!1,m=Math.ceil(tMax/dt),d=Math.ceil(tMax/dt);for(i=0;i<sit1IceArray.length;i++)sit1IceArray[i][1]>=maxIce&&(sit1IceArray[i][1]=maxIce,p||(m=i),p=!0);for(i=0;i<sit2IceArray.length;i++)sit2IceArray[i][1]>=maxIce&&(sit2IceArray[i][1]=maxIce,h||(d=i),h=!0);if(sit1TempArray=functionToArray(tempVsTime1,["t",0,m*dt,dt]),sit2TempArray=functionToArray(tempVsTime2,["t",0,d*dt,dt]),p){let e=sit1TempArray.last()[1],a=`(${n*e+l*o} + ${(e-o)*l} * e^( ${(-n-l)*t/(n*l)} * (t - ${m*dt}) )) / ${n+l}`,r=functionToArray(a,["t",m*dt,tMax,dt]);sit1TempArray=sit1TempArray.concat(r);let s=`(${n*e+l*o} - ${(e-o)*n} * e^( ${(-n-l)*t/(n*l)} * (t - ${m*dt}) )) / ${n+l}`,c=functionToArray(s,["t",m*dt,tMax,dt]);for(i=m;i<m+c.length;i++)water1TempArray[i][1]=c[i-m][1]}if(h){let t=sit2TempArray.last()[1],a=`(${s*t+l*o} + ${(t-o)*l} * e^(${(-s-l)*e/(s*l)} * (t - ${d*dt}))) / ${s+l}`,r=functionToArray(a,["t",d*dt,tMax,dt]);sit2TempArray=sit2TempArray.concat(r);let n=`(${s*t+l*o} - ${(t-o)*s} * e^( ${(-s-l)*e/(s*l)} * (t - ${d*dt}) )) / ${s+l}`,c=functionToArray(n,["t",d*dt,tMax,dt]);for(i=d;i<d+c.length;i++)water2TempArray[i][1]=c[i-d][1]}xAxisLimit=Math.ceil(tMax),yAxisLimit1=Math.max(Math.min(1.1*sit2IceArray.last()[1],10.5),Math.min(1.1*sit1IceArray.last()[1],10.5)),yAxisLimit2=Math.max(initialTemp1,initialTemp2),console.log()}function pictureBehavior(){if(0==currentStep&&!blocksDropped&&experimentRunning)y*=1.06,blockHeight-=y,$(".sit1block").css("bottom",blockHeight+"%"),$(".sit2block").css("bottom",blockHeight+"%"),blockHeight<=fallDist?(blocksDropped=!0,y=.75):blocksDropped=!1;else if(experimentRunning){currentIceHeight1=Math.max(0,iceMaxHeight1*(maxIce-sit1IceArray[currentStep][1])/maxIce);let t=currentIceHeight1+"%";currentIceWidth1=Math.max(0,iceMaxWidth1*(maxIce-sit1IceArray[currentStep][1])/maxIce);let e=currentIceWidth1+"%";currentIceHeight2=Math.max(0,iceMaxHeight2*(maxIce-sit2IceArray[currentStep][1])/maxIce);let i=currentIceHeight2+"%";currentIceWidth2=Math.max(0,iceMaxWidth2*(maxIce-sit2IceArray[currentStep][1])/maxIce);let a=currentIceWidth2+"%";blockHeight>3&&(blockHeight-=.3),$(".sit1block").css("bottom",blockHeight+"%"),$(".sit2block").css("bottom",blockHeight+"%"),$(".sit1Ice").css({height:t,width:e}),$(".sit2Ice").css({height:i,width:a})}}function pauseMelting(){experimentStarted&&(experimentRunning?(experimentRunning=!1,$("#startButton").html("Start")):(experimentRunning=!0,$("#startButton").html("Pause"),pictureBehavior()))}function startMelting(){experimentStarted?pauseMelting():(resetExperiment(),$("#startButton").attr("disabled","disabled"),$("#startButton").css("border-color","gray"),$("#startButton").html("Pause"),generateGraphPoints(),experimentRunning=!0,experimentStarted=!0,currentStep=0,blockHeight=51,panel1.disableControl("Initial Temperature"),panel1.disableControl("Block Heat Capacity"),panel1.disableControl("Block Mass"),panel1.disableControl("Block Area"),panel1.disableControl("Number of Blocks"),panel1.disableControl("Add Stir Bar"),panel2.disableControl("Initial Temperature"),panel2.disableControl("Block Heat Capacity"),panel2.disableControl("Block Mass"),panel2.disableControl("Block Area"),panel2.disableControl("Number of Blocks"),panel2.disableControl("Add Stir Bar"),panel3.disableControl("duration to simulate"))}function resetExperiment(){for((experimentRunning||experimentStarted)&&(panel1.enableControl("Initial Temperature"),panel1.enableControl("Block Heat Capacity"),panel1.enableControl("Block Mass"),panel1.enableControl("Block Area"),panel1.enableControl("Number of Blocks"),panel1.enableControl("Add Stir Bar"),panel2.enableControl("Initial Temperature"),panel2.enableControl("Block Heat Capacity"),panel2.enableControl("Block Mass"),panel2.enableControl("Block Area"),panel2.enableControl("Number of Blocks"),panel2.enableControl("Add Stir Bar"),panel3.enableControl("duration to simulate")),experimentRunning=!1,experimentStarted=!1,blocksDropped=!1,$("#startButton").removeAttr("disabled"),$("#startButton").css("border-color","#093"),$("#startButton").html("Start"),$(".sit1Ice").css({height:"14.3%",width:"10.0%"}),$(".sit2Ice").css({height:"14.3%",width:"10.0%"}),currentIceHeight1=14.3,currentIceWidth1=10,currentIceHeight2=14.3,currentIceWidth2=10,currentStep=0,blockHeight=51,sit1PtsGraph1=[],sit2PtsGraph1=[],sit1PtsGraph2=[],sit2PtsGraph2=[],sit1IceArray=[[0,0]],sit2IceArray=[[0,0]],sit1TempArray=[[0,initialTemp1]],sit2TempArray=[[0,initialTemp2]],i=1;i<=4e3;i++)water1TempArray[i]=[i,0],water2TempArray[i]=[i,0];getAreas(),getNumBlocks()}function draw(){switch(frameRate(60),pictureBehavior(),background(color(255,255,255)),$("#temps1").html(`water temperature: ${0==currentStep?icewaterTemp:water1TempArray[currentStep][1].toFixed(1)} °C<br>block temperature: ${0==currentStep?initialTemp1:sit1TempArray[currentStep][1].toFixed(1)} °C`),$("#temps2").html(`water temperature: ${0==currentStep?icewaterTemp:water2TempArray[currentStep][1].toFixed(1)} °C<br>block temperature: ${0==currentStep?initialTemp2:sit2TempArray[currentStep][1].toFixed(1)} °C`),showWhichGraph){case"1":drawPlot2(),drawPlot1();break;case"2":case"3":drawPlot1(),drawPlot2()}blocksDropped&&experimentRunning&&(currentStep+=Math.floor(2*frMult),currentStep>=Math.floor(tMax/dt-1)&&(currentStep=Math.floor(tMax/dt-1))),currentStep>=Math.floor(tMax/dt-1)&&(experimentRunning=!1,$("#startButton").removeAttr("disabled"),$("#startButton").css("border-color","#093"),$("#startButton").html("Start"))}function drawPlot1(){if(plot1.setXLim(0,xAxisLimit),plot1.setYLim(0,Math.ceil(yAxisLimit1)),plot1.beginDraw(),plot1.drawBackground(),plot1.drawLimits(),plot1.drawXAxis(),plot1.drawYAxis(),plot1.drawTitle(),plot1.drawBox(),plot1.drawGridLines(2),push(),strokeWeight(3.5),blocksDropped){textAlign(BOTTOM),textSize(20),textStyle(BOLD),fill(204,0,0);let t=plot1.mainLayer.valueToPlot(sit1IceArray[currentStep][0],sit1IceArray[currentStep][1]);text("1",t[0]+5,t[1]),fill(0,51,204);let e=plot1.mainLayer.valueToPlot(sit2IceArray[currentStep][0],sit2IceArray[currentStep][1]);text("2",e[0]+5,e[1]),stroke(204,0,0),sit1PtsGraph1.push(sit1IceArray[currentStep]),arrayToPlot(sit1PtsGraph1,plot1,!0),stroke(0,51,204),sit2PtsGraph1.push(sit2IceArray[currentStep]),arrayToPlot(sit2PtsGraph1,plot1,!0)}pop(),plot1.endDraw()}function drawPlot2(){if(plot2.setXLim(0,xAxisLimit),plot2.setYLim(0,20*Math.ceil(yAxisLimit2/20)),plot2.beginDraw(),plot2.drawBackground(),plot2.drawLimits(),plot2.drawXAxis(),plot2.drawYAxis(),plot2.drawTitle(),plot2.drawBox(),plot2.drawGridLines(2),push(),strokeWeight(3.5),blocksDropped){textAlign(BOTTOM),textSize(20),textStyle(BOLD),fill(204,0,0);let t=plot2.mainLayer.valueToPlot(sit1TempArray[currentStep][0],sit1TempArray[currentStep][1]);text("1",t[0]+5,t[1]),fill(0,51,204);let e=plot2.mainLayer.valueToPlot(sit2TempArray[currentStep][0],sit2TempArray[currentStep][1]);text("2",e[0]+5,e[1]),stroke(204,0,0),sit1PtsGraph2.push(sit1TempArray[currentStep]),arrayToPlot(sit1PtsGraph2,plot2,!0),stroke(0,51,204),sit2PtsGraph2.push(sit2TempArray[currentStep]),arrayToPlot(sit2PtsGraph2,plot2,!0)}pop(),plot2.endDraw()}function getAreas(){let t=Math.min(clientWidth/1200,clientHeight/1e3),e=Math.min(48,5+Math.sqrt(area1)*t*8)+"px",i=Math.min(48,5+Math.sqrt(area2)*t*8)+"px";$(".sit1block").css({height:e,width:e,bottom:"51%"}),$(".sit2block").css({height:i,width:i,bottom:"51%"})}function getNumBlocks(){switch(1*numBlocks1){case 1:$("#sit1block1").hide(),$("#sit1block2").hide(),$("#sit1block3").show(),$("#sit1block4").hide();break;case 2:$("#sit1block1").hide(),$("#sit1block2").show(),$("#sit1block3").show(),$("#sit1block4").hide();break;case 3:$("#sit1block1").show(),$("#sit1block2").show(),$("#sit1block3").show(),$("#sit1block4").hide();break;case 4:$("#sit1block1").show(),$("#sit1block2").show(),$("#sit1block3").show(),$("#sit1block4").show()}switch(1*numBlocks2){case 1:$("#sit2block1").hide(),$("#sit2block2").hide(),$("#sit2block3").show(),$("#sit2block4").hide();break;case 2:$("#sit2block1").hide(),$("#sit2block2").show(),$("#sit2block3").show(),$("#sit2block4").hide();break;case 3:$("#sit2block1").show(),$("#sit2block2").show(),$("#sit2block3").show(),$("#sit2block4").hide();break;case 4:$("#sit2block1").show(),$("#sit2block2").show(),$("#sit2block3").show(),$("#sit2block4").show()}}$(document).ready(init);let maxWidth=Math.min(document.documentElement.clientWidth,1200),maxHeight=Math.min(document.documentElement.clientHeight,1e3),minWidth=Math.max(600,document.documentElement.clientWidth),minHeight=Math.max(500,document.documentElement.clientHeight),clientWidth=Math.max(minWidth,maxWidth),clientHeight=Math.max(minHeight,maxHeight);clientWidth>1.2*clientHeight?clientWidth=1.2*clientHeight:clientHeight=clientWidth/1.2;let initialTemp1,heatCapacity1,mass1,area1,numBlocks1,stirFactor1,initialTemp2,heatCapacity2,mass2,area2,numBlocks2,stirFactor2,HD=window.devicePixelRatio,icewaterTemp=0,waterHeatCap=4.184,waterMass=100,waterHeatFusion=333.05,maxIce=10,water1TempArray=[[0,0]],water2TempArray=[[0,0]];for(i=1;i<=4e3;i++)water1TempArray.push([i,0]),water2TempArray.push([i,0]);let iceMeltedVsTime1,iceMeltedVsTime2,tempVsTime1,tempVsTime2,panel1,panel2,panel3,plot1,plot2,currentIceWidth1,currentIceHeight1,currentIceWidth2,currentIceHeight2,bkHeight,boxHeight,blockHeight,fallDist,sit1IceArray=[[0,0]],sit2IceArray=[[0,0]],sit1TempArray=[[0,initialTemp1]],sit2TempArray=[[0,initialTemp2]],tMax=120,dt=tMax/2e3,frMult=2,xAxisLimit=tMax,yAxisLimit1=1,yAxisLimit2=400,showWhichGraph="3",currentStep=0,experimentStarted=!1,experimentRunning=!1,blocksDropped=!1,graphInfoShowing=!1,iceMaxHeight1=14.3,iceMaxWidth1=10,iceMaxHeight2=14.3,iceMaxWidth2=10,y=.75;var graphFontSize=12;Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),window.onload=function(){QuickSettings.useExtStyleSheet(),panel1=QuickSettings.create(0,30,"Beaker 1",document.body,"red").addRange("Initial temperature",1,100,30,1,function(t){initialTemp1=t},"°C").addRange("Block heat capacity",.1,10,4,.1,function(t){heatCapacity1=t},"&nbspJ / (g°C)").addRange("Block mass",.1,5,2,.1,function(t){mass1=t},"&nbspg (per block)").addRange("Block area",1,9,4,1,function(t){area1=t,getAreas()},"&nbspcm² (per block)").addRange("Number of blocks",1,4,2,1,function(t){numBlocks1=t,getNumBlocks()}).addBoolean("Add stir bar",!1,function(t){t?($("#stirBar1").show(),stirFactor1=1e3):($("#stirBar1").hide(),stirFactor1=300)}).setDraggable(!0),panel2=QuickSettings.create($("#bottomCenter").width()-220,30,"Beaker 2",document.body,"blue").addRange("Initial temperature",1,100,80,1,function(t){initialTemp2=t},"°C").addRange("Block heat capacity",.1,10,1,.1,function(t){heatCapacity2=t},"&nbspJ / (g°C)").addRange("Block mass",.1,10,1,.1,function(t){mass2=t},"&nbspg (per block)").addRange("Block area",1,9,1,1,function(t){area2=t,getAreas()},"&nbspcm² (per block)").addRange("Number of blocks",1,4,1,1,function(t){numBlocks2=t,getNumBlocks()}).addBoolean("Add stir bar",!1,function(t){t?($("#stirBar2").show(),stirFactor2=1e3):($("#stirBar2").hide(),stirFactor2=300)}).setDraggable(!0),panel3=QuickSettings.create(0,30,"Plot Options",document.body,"graph").addRange("Simulation time",10,500,120,1,function(t){tMax=t,dt=tMax/2e3},"s").addRange("Animation speed",.5,5,1,.5,function(t){frMult=t},"x"),windowResized()};