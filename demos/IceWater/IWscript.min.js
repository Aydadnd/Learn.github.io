function windowResized(){maxWidth=Math.min(.95*document.documentElement.clientWidth,1200),maxHeight=Math.min(.95*document.documentElement.clientHeight,1e3),minWidth=Math.max(600,.95*document.documentElement.clientWidth),minHeight=Math.max(500,.95*document.documentElement.clientHeight),clientWidth=Math.max(minWidth,maxWidth),clientHeight=Math.max(minHeight,maxHeight),clientWidth>1.2*clientHeight?clientWidth=1.2*clientHeight:clientHeight=clientWidth/1.2,$(":root").css({"font-size":11+(clientWidth-600)/600*4+"px"}),graphFontSize=12+(clientWidth-600)/600*4,plot.setAllFontProperties("Helvetica",color(0,0,0),graphFontSize);let t=$("#topLeft").width(),e=$("#topRight").width(),i=170;panel1.setWidth(t-10),panel2.setWidth(e-10),panel1.setPosition(0,10),panel2.setPosition($("#bottomCenter").width()-e,10),panel3.setWidth(i-10),panel3.setPosition($("#bottomCenter").width()-170,.7*clientHeight-40),bkHeight=$("#beakersImg").height(),boxHeight=$("#topCenter").height(),fallDist=.6*bkHeight/boxHeight*100,plot.setOuterDim(clientWidth-170,.54*clientHeight),plot.setPos(10,0),resizeCanvas(clientWidth/.95,cnv.height=.54*clientHeight/.95),clear()}function init(){$("#startButton").on("click",startMelting),$("#resetButton").on("click",resetExperiment),beaker1=new Beaker(10,10,303),beaker2=new Beaker(10,50,303),QuickSettings.useExtStyleSheet(),panel1=QuickSettings.create(0,30,"Beaker 1",document.body,"red").addRange("Mass of ice",10,100,30,1,function(t){beaker1.mI=t}," g").addRange("Crushedness",0,100,50,1,function(t){beaker1.crushedness=t}).setDraggable(!0),panel2=QuickSettings.create(0,30,"Beaker 1",document.body,"red").addRange("Mass of ice",10,100,30,1,function(t){beaker2.mI=t}," g").addRange("Crushedness",0,100,50,1,function(t){beaker2.crushedness=t}).setDraggable(!0),panel3=QuickSettings.create(0,30,"Plot Options",document.body,"graph").addRange("Simulation time",10,500,120,1,function(t){tMax=t,dt=tMax/2e3},"s").addRange("Animation speed",.5,5,1,.5,function(t){frMult=t},"x"),windowResized()}function setup(){pixelDensity(HD),cnv=createCanvas(100,100),cnv.parent("bottomCenter"),plot=new GPlot(this),plot.setPos(10,0),plot.setOuterDim(200,100),plot.setYLim(0,1),plot.getXAxis().getAxisLabel().setText("time (s)"),plot.getYAxis().getAxisLabel().setText("temperature (K)"),plot.getTitle().setText("temperature of water"),smooth()}function pictureBehavior(){0==currentStep&&!iceDropped&&experimentRunning&&(y*=1.06,iceHeight-=y,iceHeight<=fallDist?(iceDropped=!0,y=.75):iceDropped=!1)}function pauseMelting(){experimentStarted&&(experimentRunning?(experimentRunning=!1,$("#startButton").html("Start")):(experimentRunning=!0,$("#startButton").html("Pause"),pictureBehavior()))}function startMelting(){experimentStarted?pauseMelting():(resetExperiment(),$("#startButton").attr("disabled","disabled"),$("#startButton").css("border-color","gray"),$("#startButton").html("Pause"),beaker1.generateGraphPoints(),beaker2.generateGraphPoints(),experimentRunning=!0,experimentStarted=!0,currentStep=0,panel3.disableControl("duration to simulate"))}function resetExperiment(){experimentRunning=!1,experimentStarted=!1,iceDropped=!1,sit1GraphPts=[],sit2GraphPts=[],$("#startButton").removeAttr("disabled"),$("#startButton").css("border-color","#093"),$("#startButton").html("Start"),currentStep=0,iceHeight=51}function draw(){frameRate(60),pictureBehavior(),background(color(255,255,255)),drawPlot(),iceDropped&&experimentRunning&&(currentStep+=Math.floor(2*frMult),currentStep>=Math.floor(tMax/dt-1)&&(currentStep=Math.floor(tMax/dt-1))),currentStep>=Math.floor(tMax/dt-1)&&(experimentRunning=!1,$("#startButton").removeAttr("disabled"),$("#startButton").css("border-color","#093"),$("#startButton").html("Start"))}function drawPlot(){if(plot.setXLim(0,xAxisLimit),plot.setYLim(0,Math.ceil(yAxisLimit)),plot.beginDraw(),plot.drawBackground(),plot.drawLimits(),plot.drawXAxis(),plot.drawYAxis(),plot.drawTitle(),plot.drawBox(),plot.drawGridLines(2),push(),strokeWeight(3.5),iceDropped){textAlign(BOTTOM),textSize(20),textStyle(BOLD),fill(204,0,0);let t=plot.mainLayer.valueToPlot(beaker1.tempArray[currentStep][0],beaker1.tempArray[currentStep][1]);text("1",t[0]+5,t[1]),fill(0,51,204);let e=plot.mainLayer.valueToPlot(beaker2.tempArray[currentStep][0],beaker2.tempArray[currentStep][1]);text("2",e[0]+5,e[1]),stroke(204,0,0),sit1GraphPts.push(beaker1.tempArray[currentStep]),arrayToPlot(sit1GraphPts,plot,!0),stroke(0,51,204),sit2GraphPts.push(beaker2.tempArray[currentStep]),arrayToPlot(sit2GraphPts,plot,!0)}pop(),plot.endDraw()}$(document).ready(init);let maxWidth=Math.min(document.documentElement.clientWidth,1200),maxHeight=Math.min(document.documentElement.clientHeight,1e3),minWidth=Math.max(600,document.documentElement.clientWidth),minHeight=Math.max(500,document.documentElement.clientHeight),clientWidth=Math.max(minWidth,maxWidth),clientHeight=Math.max(minHeight,maxHeight);clientWidth>1.2*clientHeight?clientWidth=1.2*clientHeight:clientHeight=clientWidth/1.2;let initialTemp,heatCapacity,mass,U,panel1,panel2,panel3,plot,HD=window.devicePixelRatio,iceTemp=0,waterHeatCap=4.184,waterMass=100,waterHF=333.05,tMax=120,dt=tMax/2e3,frMult=2,xAxisLimit=tMax,yAxisLimit=400;var beaker1,beaker2;let bkHeight,boxHeight,iceHeight,fallDist,sit1GraphPts=[],sit2GraphPts=[],currentStep=0,experimentStarted=!1,experimentRunning=!1,iceDropped=!1,iceMaxHeight=14.3,iceMaxWidth=10,y=.75;var graphFontSize=12;Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]});class Beaker{constructor(t,e,i){this.mI=t,this.mW=waterMass,this.crushedness=e,this.Ti=i,this.k=e/1e3,this.HF=waterHF,this.cp=waterHeatCap,this.height=iceMaxHeight/e,this.width=iceMaxWidth/e}generateGraphPoints(){this.finalTemp=(this.mW*this.cp*this.Ti-this.mI*this.HF)/(this.cp*(this.mI+this.mW)),this.tempArray=functionToArray(`${this.finalTemp} + ${this.Ti-this.finalTemp}e^(${-this.k}*t)`,["t",0,tMax,dt])}}