function setup(){let e=document.getElementById("main"),t=document.createElement("button");t.id="resetbutton",t.innerText="reset",t.onclick=reset,t.style.zIndex=2,t.style.position="absolute",t.style.top="10px",e.appendChild(t);let n=windowResized(!0);t.style.left=`${instrX}px`;let s=createCanvas(n,n);s.parent("main"),s.position(0,0),s.style("z-index",0),frameRate(fps),w=n/100,h=n/100,textAlign(LEFT,TOP),windowResized(),background(255,255,255)}function draw(){update&&drawPage(page),effects&&applyEffect(effect),update=!1}function drawPage(e){switch(clear(),e){case 1:removeElements(),choices=[],domObjs=[],effect=[],text("Click an equation to get started.",instrX,instrY);let t=Object.keys(eqns.fundamentals);for(let e=0;e<t.length;e++){domObjs.push(new Tex({content:eqns.fundamentals[t[e]],position:[texX,texY+lnHt*(e+1)],name:`${t[e]}`})),domObjs[e].div.addClass("eq"),domObjs[e].div.id(`eq${e}`);let n=`${e}`;document.getElementById(`eq${n}`).addEventListener("mousedown",()=>{1==page&&choices.push(parseInt(n)),next(1,choices[0])})}break;case 2:text("Click the differential term you would like held constant\n(options are colored)",instrX,instrY);for(let e=0;e<domObjs.length;e++)e!=choices[0]&&domObjs[e].div.remove();effect=[],letters=document.querySelectorAll("mjx-container")[0].firstChild.childNodes,glowLetters=0==choices[0]||2==choices[0]?[0,1,4,5,8,9]:1==choices[0]||3==choices[0]?[0,1,5,6,9,10]:[0,1,4,5,8,9];for(let e=0;e<glowLetters.length;e++){let t=letters[glowLetters[e]],n=`${Math.floor(e/2)}`;effect.push({target:t,effect:"color",color:`${n}`}),e>=2&&t.addEventListener("mousedown",()=>{next(2,n)})}effects=!0;break;case 3:domObjs.push(new Tex({content:`\\left( \\frac{\\partial ${partials[0]}}{\\partial ${partials[1]}} \\right)_{\\scriptscriptstyle ${constant}}=${rhs}`,position:[texX,texY],name:"partial"})),domObjs[domObjs.length-1].div.id("final"),finalEq=document.querySelectorAll("mjx-container")[1].firstChild,finalEq.style.fontSize=`${largeFontSize}rem`,topPartial=finalEq.firstChild.childNodes[0].childNodes[1].firstChild.childNodes[0],bottomPartial=finalEq.firstChild.childNodes[0].childNodes[1].firstChild.childNodes[1],constantText=finalEq.firstChild.childNodes[1],refLeft=getCoords(constantText).right,domObjs[domObjs.length-1].div.hide(),effect.push({target:[letters[constantIndex],letters[constantIndex+1]],effect:"zeroAndDelete"}),effects=!0,loop();break;case 4:text("With constant",instrX,instrY);let n=domObjs[domObjs.length-1];n.div.show(),n.div.style("opacity","0"),effect.push({target:topPartial,effect:"color",color:0}),effect.push({target:bottomPartial,effect:"color",color:`${1==choices[1]?2:1}`}),effect.push({target:constantText,effect:"color",color:`${2==choices[1]?2:1}`}),effects=!0,next(4,null);break;case 5:text("With constant ",instrX,instrY);let s=textWidth("With constant "),o=new Tex({content:`${constant},`,position:[instrX+s+.05*lnHt,instrY-.1*lnHt]});o.div.id("constantLetter"),effect.push({target:document.getElementById("constantLetter"),effect:"color",color:`${2==choices[1]?2:1}`}),effects=!0,page++,window.setTimeout(e=>{update=!0},2e3);break;case 6:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt),window.setTimeout(e=>{update=!0},2e3),page++;break;case 7:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt);let i=document.getElementById("final");i.style.top=`${texY+4*lnHt}px`,i.style.opacity=1,noLoop()}update=!1}function next(e,t){if(e==page)switch(page){case 1:let e;for(i=0;i<domObjs.length;i++){e=i!=t?"fade":"expand";let n=document.getElementById(`eq${i}`);effect.push({target:n,effect:e})}effects=!0,redraw(),update=!0,page++;break;case 2:choices.push(t);let n=Object.keys(eqns.fundamentals),s=eqns.fundamentals[n[choices[0]]];constant=s.charAt(glowLetters[2*t+1]),constantIndex=glowLetters[2*t],glowLetters.splice(2*t,2);let o=s.charAt(glowLetters[2]-1);for(rhs="-"==s.charAt(glowLetters[2]-2)?`-${o}`:`${o}`,partials=[],i=0;i<glowLetters.length/2;i++)partials.push(s[glowLetters[2*i+1]]);update=!0,page++;break;case 3:effect=[],effects=!1,page++,drawPage(page);break;case 4:page++,drawPage(page)}}function reset(){location.reload()}function resizeFont(){let e=Number(window.getComputedStyle(document.getElementById("main")).getPropertyValue("font-size").replace(/[^\d.-]/g,""));fontSize=100*w<400?e:100*w<1200?100*w/28:1200/28,textSize(fontSize),lnHt=1.5*fontSize,instrX=5*w,instrY=lnHt+10+getCoords(document.getElementById("resetbutton")).height,texX=instrX,texY=instrY+lnHt,largeFontSize=2.2*fontSize/10}function windowResized(e){let t=windowWidth,n=windowHeight,s=Math.min(t,n);if(w=s/100,h=s/100,resizeFont(),1==e)return s;resizeCanvas(s,s),update=!0}function selectItem(e,t,n,s){let o=[],i=[];o=0==n?[0,2]:-1!=e.search("=-")?1==n?[3,7]:2==n?[7,11]:3==n?[11,15]:[0,2]:1==n?[3,6]:2==n?[6,10]:3==n?[10,14]:[0,2];for(let e=o[0];e<o[1];e++)i.push(t[e]);return s?e.slice(o[0],o[1]):i}function getCoords(e){let t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset,bottom:t.top+pageYOffset+t.height,right:t.left+pageXOffset+t.width,height:t.height,width:t.width}}let w,h,instrX,instrY,texX,texY,lnHt,fontSize,largeFontSize,i,constant,constantIndex,restart,finalEq,topPartial,bottomPartial,constantText,refLeft,rhs,eqns={fundamentals:{U:"dU=TdS-PdV",A:"dA=-SdT-PdV",H:"dH=TdS+VdP",G:"dG=-SdT+VdP",Rand:"d§=▲d♫-♣dΩ"}},choices=[],domObjs=[],page=1,update=!1,effects=!1,effect=[],letters=[],glowLetters=[],fps=20,partials=[];