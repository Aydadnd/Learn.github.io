function setup(){let t=document.getElementById("main"),e=document.createElement("button");e.id="resetbutton",e.innerText="reset",e.onclick=reset,e.style.zIndex=2,e.style.position="absolute",e.style.top="10px",t.appendChild(e);let s=windowResized(!0);e.style.left=`${instrX}px`;let i=createCanvas(s,s);i.parent("main"),i.position(0,0),i.style("z-index",0),frameRate(fps),w=s/100,h=s/100,textAlign(LEFT,TOP),windowResized(),background(255,255,255)}function draw(){update&&drawPage(page),effects&&applyEffect(effect),update=!1}function drawPage(t){switch(clear(),t){case 1:removeElements(),choices=[],domObjs=[],effect=[],text("Click an equation to get started.",instrX,instrY),k=Object.keys(eqns.fundamentals);for(let t=0;t<k.length;t++){domObjs.push(new Tex({content:eqns.fundamentals[k[t]],position:[texX,texY+lnHt*(t+1)],name:`${k[t]}`})),domObjs[t].div.addClass("eq"),domObjs[t].div.id(`eq${t}`);let e=`${t}`;document.getElementById(`eq${e}`).addEventListener("mousedown",()=>{1==page&&choices.push(parseInt(e)),next(1,choices[0])})}break;case 2:text("Click the differential term you would like held constant\n(options are colored)",instrX,instrY);for(let t=0;t<domObjs.length;t++)t!=choices[0]&&domObjs[t].div.remove();effect=[],letters=document.querySelectorAll("mjx-container")[0].firstChild.childNodes,glowLetters=0==choices[0]||2==choices[0]?[0,1,4,5,8,9]:1==choices[0]||3==choices[0]?[0,1,5,6,9,10]:[0,1,4,5,8,9];for(let t=0;t<glowLetters.length;t++){let e=letters[glowLetters[t]],s=`${Math.floor(t/2)}`;effect.push({target:e,effect:"color",color:`${s}`}),t>=2&&e.addEventListener("mousedown",()=>{next(2,s)})}effects=!0;break;case 3:domObjs.push(new Tex({content:`\\left( \\frac{\\partial ${partials[0]}}{\\partial ${partials[1]}} \\right)_{\\scriptscriptstyle ${constant}}=${rhs}`,position:[texX,texY],name:"partial"})),domObjs[domObjs.length-1].div.id("final"),finalEq=document.querySelectorAll("mjx-container")[1].firstChild,finalEq.style.fontSize=`${largeFontSize}rem`,topPartial=finalEq.firstChild.childNodes[0].childNodes[1].firstChild.childNodes[0],bottomPartial=finalEq.firstChild.childNodes[0].childNodes[1].firstChild.childNodes[1],constantText=finalEq.firstChild.childNodes[1],refLeft=getCoords(constantText).right,domObjs[domObjs.length-1].div.hide(),effect.push({target:[letters[constantIndex],letters[constantIndex+1]],effect:"zeroAndDelete"}),effects=!0,loop();break;case 4:text("With constant",instrX,instrY);let e=domObjs[domObjs.length-1];e.div.show(),e.div.style("opacity","0"),effect.push({target:topPartial,effect:"color",color:0}),effect.push({target:bottomPartial,effect:"color",color:`${1==choices[1]?2:1}`}),effect.push({target:constantText,effect:"color",color:`${2==choices[1]?2:1}`}),effects=!0,next(4,null);break;case 5:text("With constant ",instrX,instrY),sWidth=textWidth("With constant "),cnst=new Tex({content:`${constant},`,position:[instrX+sWidth+.05*lnHt,instrY-.1*lnHt]}),cnst.div.id("constantLetter"),effect.push({target:document.getElementById("constantLetter"),effect:"color",color:`${2==choices[1]?2:1}`}),effects=!0,page++,window.setTimeout(t=>{update=!0},textDelay);break;case 6:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt),window.setTimeout(t=>{update=!0},textDelay),page++;break;case 7:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt);let o=document.getElementById("final");o.style.top=`${texY+4*lnHt}px`,o.style.opacity="1",window.setTimeout(t=>{update=!0},textDelay),page++;break;case 8:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt),text("click anywhere to continue.",instrX,getCoords(document.getElementById("final")).bottom+lnHt),document.getElementsByClassName("p5Canvas")[0].addEventListener("mousedown",()=>{next(8,null)});break;case 9:if(s=2,selectItem(str,letters,choices[1]).forEach(function(t){t.style.visibility="visible",t.style.transition=`opacity ${s}s`,t.style.opacity="1"}),1==choices[1]){let t=selectItem(str,letters,2);negativeQ||setTimeout(()=>{t[0].style.visibility="visible",t[0].style.opacity="1"},1e3*s),t.forEach(function(t){t.style.transition=`all ${s}s`,t.style.transform="translateX(0px)"})}objt=document.getElementById("final"),objt.style.transition=`all ${s}s`,objt.style.top=`${90*h-2*lnHt}px`,document.getElementById(`eq${choices[0]}`).style.top=`${texY+1.2*lnHt}px`,document.getElementById("constantLetter").remove(),page++,window.setTimeout(t=>{update=!0},2e3);break;case 10:choices[1]=1==choices[1]?2:1,effect=[];let n="Now, derive the other state function by holding \nconstant. Click ";sWidth=textWidth("Now, derive the other state function by holding ");let l=textWidth("constant. Click "),r=selectItem(str,letters,choices[1],!0);for(constant=r[r.length-1],partials=[str[1],1==choices[1]?str[glowLetters[5]]:str[glowLetters[3]]],cnst2=new Tex({content:`d${constant}`,position:[instrX+sWidth+.05*lnHt,instrY-.1*lnHt]}),cnst3=new Tex({content:`d${constant}`,position:[instrX+l+.05*lnHt,instrY+lnHt-.1*lnHt]}),cnst2.div.id("constantLetter2"),effect.push({target:document.getElementById("constantLetter2"),effect:"color",color:`${2==choices[1]?2:1}`}),cnst3.div.id("constantLetter3"),effect.push({target:document.getElementById("constantLetter3"),effect:"color",color:`${2==choices[1]?2:1}`}),text(n,instrX,instrY),text("\n now.",getCoords(document.getElementById("constantLetter3")).right+.05*lnHt,instrY),i=0;i<domObjs.length;i++)domObjs[i].div.style("z-index","1");let d=1==choices[1]?[2,3]:[4,5],c=[letters[glowLetters[d[0]]],letters[glowLetters[d[1]]]];c.forEach(t=>{t.addEventListener("mousedown",()=>{next(10,choices[1])})});break;case 11:cnst2.div.remove(),cnst3.div.remove(),domObjs.push(new Tex({content:`\\left( \\frac{\\partial ${partials[0]}}{\\partial ${partials[1]}} \\right)_{\\scriptscriptstyle ${constant}}=${rhs}`,position:[texX,texY],name:"partial2"})),domObjs[domObjs.length-1].div.id("final2"),finalEq2=document.getElementById("final2").firstChild.firstChild,finalEq2.style.fontSize=`${largeFontSize}rem`,topPartial2=finalEq2.firstChild.childNodes[0].childNodes[1].firstChild.childNodes[0],bottomPartial2=finalEq2.firstChild.childNodes[0].childNodes[1].firstChild.childNodes[1],constantText2=finalEq2.firstChild.childNodes[1],refLeft=getCoords(constantText2).right,domObjs[domObjs.length-1].div.hide(),effect.push({target:[letters[constantIndex],letters[constantIndex+1]],effect:"zeroAndDelete"}),effects=!0,loop();break;case 12:text("With constant",instrX,instrY);let a=domObjs[domObjs.length-1];a.div.show(),a.div.style("opacity","0"),effect.push({target:topPartial2,effect:"color",color:0}),effect.push({target:bottomPartial2,effect:"color",color:`${1==choices[1]?2:1}`}),effect.push({target:constantText2,effect:"color",color:`${2==choices[1]?2:1}`}),effects=!0,next(12,null);break;case 13:text("With constant ",instrX,instrY),sWidth=textWidth("With constant "),cnst4=new Tex({content:`${constant},`,position:[instrX+sWidth+.05*lnHt,instrY-.1*lnHt]}),cnst4.div.id("constantLetter4"),effect.push({target:document.getElementById("constantLetter4"),effect:"color",color:`${2==choices[1]?2:1}`}),effects=!0,page++,window.setTimeout(t=>{update=!0},textDelay);break;case 14:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt),window.setTimeout(t=>{update=!0},textDelay),page++;break;case 15:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt);let f=document.getElementById("final2");f.style.top=`${texY+4*lnHt}px`,f.style.opacity="1",window.setTimeout(t=>{update=!0},textDelay),page++;break;case 16:text("With constant",instrX,instrY),text("therefore,",instrX,texY+2.5*lnHt),text("click anywhere to continue.",instrX,getCoords(document.getElementById("final2")).bottom+lnHt),document.getElementsByClassName("p5Canvas")[0].addEventListener("mousedown",()=>{next(16,null)});break;case 17:s=2,letters.forEach(t=>{t.style.visibility="inherit",t.style.opacity="0",t.style.transform="translateX(0px)"}),objt2=document.getElementById("final2"),objt2.style.transition=`all ${s}s`,objt2.style.top=`${getCoords(objt).top-getCoords(objt2).height-lnHt}px`,domObjs.push(new Tex({content:symmetryText,position:[texX,texY+3.5*lnHt],name:"symmetry"})),symmetry=domObjs[domObjs.length-1],symmetry.div.style("font-size",`${largeFontSize/1.4}rem`),symmetry.div.style("opacity","0"),symmetry.div.style("visibility","hidden"),document.getElementById(`eq${choices[0]}`).style.visibility="hidden",document.getElementById("constantLetter4").remove(),page++,window.setTimeout(t=>{update=!0},2e3);break;case 18:text("We know from Schwarz's theorem that second\nderivatives are distributive. That is, order doesn't\nmatter. For example, with arbitrary variables\nx, y, and z: ",instrX,instrY),symmetry.div.style("visibility","visible"),symmetry.div.id("symmetry");let m=document.getElementById("symmetry"),p=[m.firstChild.firstChild.childNodes[1].firstChild.childNodes[1].firstChild.childNodes[1],m.firstChild.firstChild.childNodes[4].childNodes[1],m.firstChild.firstChild.childNodes[10].firstChild.childNodes[1].firstChild.childNodes[1],m.firstChild.firstChild.childNodes[12].childNodes[1],m.firstChild.firstChild.childNodes[14].firstChild.childNodes[1].firstChild.childNodes[1].firstChild.childNodes[1].childNodes[0],m.firstChild.firstChild.childNodes[14].firstChild.childNodes[1].firstChild.childNodes[1].firstChild.childNodes[1].childNodes[1]],g=[m.firstChild.firstChild.childNodes[3].firstChild.childNodes[1].firstChild.childNodes[1],m.firstChild.firstChild.childNodes[5].childNodes[1],m.firstChild.firstChild.childNodes[8].firstChild.childNodes[1].firstChild.childNodes[1],m.firstChild.firstChild.childNodes[11].childNodes[1],m.firstChild.firstChild.childNodes[14].firstChild.childNodes[1].firstChild.childNodes[1].firstChild.childNodes[1].childNodes[2],m.firstChild.firstChild.childNodes[14].firstChild.childNodes[1].firstChild.childNodes[1].firstChild.childNodes[1].childNodes[3]],y=[m.firstChild.firstChild.childNodes[3].firstChild.childNodes[0],m.firstChild.firstChild.childNodes[10].firstChild.childNodes[0],m.firstChild.firstChild.childNodes[14].firstChild.childNodes[0]],u="rgb(70, 200, 50)",x="rgb(100, 100, 255)",b="rgb(0, 0, 0)";p.forEach(t=>{t.style.color=u}),g.forEach(t=>{t.style.color=x}),y.forEach(t=>{t.style.color=b}),symmetry.div.style("transition","all 2s"),symmetry.div.style("opacity","1")}}function next(t,e){if(t==page)switch(page){case 1:let t;for(i=0;i<domObjs.length;i++){t=i!=e?"fade":"expand";let s=document.getElementById(`eq${i}`);effect.push({target:s,effect:t})}effects=!0,redraw(),update=!0,page++;break;case 2:for(choices.push(e),str=eqns.fundamentals[k[choices[0]]],constant=str.charAt(glowLetters[2*e+1]),constantIndex=glowLetters[2*e],modify=[],glowLetters.forEach(t=>{t!=glowLetters[2*e]&&t!=glowLetters[2*e+1]&&modify.push(t)}),m=str.charAt(modify[2]-1),rhs="-"==str.charAt(modify[2]-2)?`-${m}`:`${m}`,partials=[],i=0;i<modify.length/2;i++)partials.push(str[modify[2*i+1]]);update=!0,page++;break;case 3:effect=[],effects=!1,page++,drawPage(page);break;case 4:page++,drawPage(page);break;case 8:update=!0,page++;break;case 10:str=eqns.fundamentals[k[choices[0]]],constant=str.charAt(glowLetters[2*e+1]),constantIndex=glowLetters[2*e],modify=[],glowLetters.forEach(t=>{t!=glowLetters[2*e]&&t!=glowLetters[2*e+1]&&modify.push(t)}),m=str.charAt(modify[2]-1),rhs="-"==str.charAt(modify[2]-2)?`-${m}`:`${m}`,update=!0,page++;break;case 11:effect=[],effects=!1,page++,drawPage(page);break;case 12:page++,drawPage(page);break;case 16:update=!0,page++}}function reset(){location.reload()}function resizeFont(){let t=Number(window.getComputedStyle(document.getElementById("main")).getPropertyValue("font-size").replace(/[^\d.-]/g,""));fontSize=100*w<400?t:100*w<1200?100*w/28:1200/28,textSize(fontSize),lnHt=1.5*textAscent(),instrX=5*w,instrY=lnHt+10+getCoords(document.getElementById("resetbutton")).height,texX=instrX,texY=instrY+lnHt,largeFontSize=2.2*fontSize/10}function windowResized(t){let e=windowWidth,s=windowHeight,i=Math.min(e,s);if(w=i/100,h=i/100,resizeFont(),1==t)return i;resizeCanvas(i,i),update=!0}function selectItem(t,e,s,i){let o=[],n=[];o=0==s?[0,2]:-1!=t.search("=-")?1==s?[3,7]:2==s?[7,11]:3==s?[11,15]:[0,2]:1==s?[3,6]:2==s?[6,10]:3==s?[10,14]:[0,2];for(let t=o[0];t<o[1];t++)n.push(e[t]);return i?t.slice(o[0],o[1]):n}function getCoords(t){let e=t.getBoundingClientRect();return{top:e.top+pageYOffset,left:e.left+pageXOffset,bottom:e.top+pageYOffset+e.height,right:e.left+pageXOffset+e.width,height:e.height,width:e.width}}let w,h,instrX,instrY,texX,texY,sWidth,lnHt,fontSize,largeFontSize,i,k,str,constant,constantIndex,modify,m,restart,finalEq,topPartial,bottomPartial,constantText,finalEq2,topPartial2,bottomPartial2,constantText2,refLeft,rhs,cnst,cnst2,cnst3,cnst4,s,objt,objt2,symmetry,eqns={fundamentals:{U:"dU=TdS-PdV",A:"dA=-SdT-PdV",H:"dH=TdS+VdP",G:"dG=-SdT+VdP",Rand:"d§=▲d♫-♣dΩ"}},choices=[],domObjs=[],page=1,update=!1,effects=!1,effect=[],letters=[],glowLetters=[],fps=30,partials=[],ctc=!1,textDelay=2e3,symmetryText="\\Big( \\frac{\\partial}{\\partial x} \\Big( \\frac{\\partial z}{\\partial y} \\Big)_{\\scriptscriptstyle x} \\Big)_{\\scriptscriptstyle y } = \\Big( \\frac{\\partial}{\\partial y} \\Big( \\frac{\\partial z}{\\partial x} \\Big)_{\\scriptscriptstyle y} \\Big)_{\\scriptscriptstyle x} = \\frac{\\partial^{2} z}{\\partial x \\partial y}";