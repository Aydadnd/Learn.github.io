function updateData(){sim.eval("Ea1 = 145"),sim.eval("Ea2 = 155"),sim.eval("R  = 8.314*10^-3"),sim.eval("A1 = 3.6*10^16"),sim.eval("A2 = 1.8*10^17"),sim.eval(`tfinal = ${tfinal}`),sim.eval(`dt = ${dt}`),sim.eval(`Ca0 = ${Cao}`),sim.eval(`Cb0 = ${Cbo}`),sim.eval(`Cc0 = ${Cco}`),sim.eval(`k1 = A1 * e^(-Ea1/(R * ${T}))`),sim.eval(`k2 = A2 * e^(-Ea2/(R * ${T}))`),sim.eval("dCadt(Ca, Cb, Cc) = -k1 * Ca"),sim.eval("dCbdt(Ca, Cb, Cc) = k1 * Ca - k2 * Cb"),sim.eval("dCcdt(Ca, Cb, Cc) = k2 * Cb"),sim.eval("result = ndsolve([dCadt, dCbdt, dCcdt], [Ca0, Cb0, Cc0], dt, tfinal)");const t=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(t){return t[0]}),n=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(t){return t[0]}),a=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(t){return t[0]});let l=t.length;for(CA=new Array(l),CB=new Array(l),CC=new Array(l),selectivity=new Array(l),i=0;i<t.length;i++){let o=tfinal/l*(i+1);CA[i]=[o,t[i]],CB[i]=[o,n[i]],CC[i]=[o,a[i]],selectivity[i]=[o,CB[i][1]/CC[i][1]]}CA.unshift([0,Cao]),CB.unshift([0,Cbo]),CC.unshift([0,Cco]),selectivity.unshift([0,100])}function windowResized(){clientWidth=Math.max(200,window.innerWidth-200),aspRatio=1,clientHeight=clientWidth*aspRatio,resizeCanvas(clientWidth,clientHeight),mainPlot.GPLOT.setOuterDim(clientWidth,clientHeight),mainPlot.GPLOT.setPos(0,0),gui.prototype.setPosition(clientWidth,mainPlot.GPLOT.mar[2])}function setup(){createCanvas(clientWidth,clientHeight),mainPlot=new PlotCanvas(this),mainPlot.xLims=[0,tfinal],mainPlot.yLims=[0,2.5],mainPlot.xAxisLabel="time (h)",mainPlot.yAxisLabel="concentration (M)",mainPlot.plotTitle="Series Reactions in a Batch Reactor",mainPlot.plotSetup(),gui=createGui("plot controls",clientWidth,mainPlot.GPLOT.mar[2]),gui.newSlider("T",450,480,450,1,"Temperature","K"),gui.newDropdown("page",["concentration","selectivity"],"display:"),updateData(),CaFunction=new ArrayPlot(CA),CaFunction.lineColor=color(255,0,0,255),CbFunction=new ArrayPlot(CB),CbFunction.lineColor=color(50,220,0,255),CcFunction=new ArrayPlot(CC),CcFunction.lineColor=color(0,0,255,255),selFunction=new ArrayPlot(selectivity),selFunction.lineColor=color(0,0,0,0),mainPlot.addFuncs(CaFunction,CbFunction,CcFunction,selFunction),noLoop()}function draw(){switch(clear(),updateData(),CaFunction.update(CA),CbFunction.update(CB),CcFunction.update(CC),selFunction.update(selectivity),page){case"selectivity":selFunction.lineColor=color(0,0,0,255),CaFunction.lineColor=color(255,0,0,0),CbFunction.lineColor=color(50,220,0,0),CcFunction.lineColor=color(0,0,255,0);break;default:selFunction.lineColor=color(0,0,0,0),CaFunction.lineColor=color(255,0,0,255),CbFunction.lineColor=color(50,220,0,255),CcFunction.lineColor=color(0,0,255,255)}mainPlot.plotDraw(),mainPlot.labelDraw("selectivity",tfinal/2,selectivity[Math.trunc(map(tfinal/2,0,tfinal,0,tfinal/dt-1))][1],selFunction.lineColor,[CENTER,CENTER],!1,[5,1.6]),mainPlot.labelDraw("C",tfinal/6,CA[Math.trunc(map(tfinal/6,0,tfinal,0,tfinal/dt-1))][1],CaFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("a",tfinal/6,CA[Math.trunc(map(tfinal/6,0,tfinal,0,tfinal/dt-1))][1],CaFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("C",tfinal/2,CB[Math.trunc(map(tfinal/2,0,tfinal,0,tfinal/dt-1))][1],CbFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("b",tfinal/2,CB[Math.trunc(map(tfinal/2,0,tfinal,0,tfinal/dt-1))][1],CbFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("C",5*tfinal/6,CC[Math.trunc(map(5*tfinal/6,0,tfinal,0,tfinal/dt-1))][1],CcFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("c",5*tfinal/6,CC[Math.trunc(map(5*tfinal/6,0,tfinal,0,tfinal/dt-1))][1],CcFunction.lineColor,[LEFT,TOP],"sub")}var gui,mainPlot,equation,CA,CB,CC,selectivity,clientWidth=Math.max(200,window.innerWidth-200),aspRatio=1,clientHeight=clientWidth*aspRatio,T=450,tfinal=15,dt=.1,Cao=2,Cbo=0,Cco=0,page="concentration";const sim=math.parser();