function updateData(){sim.eval("Ea1 = 145"),sim.eval("Ea2 = 155"),sim.eval("R  = 8.314*10^-3"),sim.eval("A1 = 3.6*10^16"),sim.eval("A2 = 1.8*10^17"),sim.eval(`tfinal = ${tfinal}`),sim.eval(`dt = ${dt}`),sim.eval(`Ca0 = ${Cao}`),sim.eval(`Cb0 = ${Cbo}`),sim.eval(`Cc0 = ${Cco}`),sim.eval(`k1 = A1 * e^(-Ea1/(R * ${T}))`),sim.eval(`k2 = A2 * e^(-Ea2/(R * ${T}))`),sim.eval("dCadt(Ca, Cb, Cc) = -k1 * Ca"),sim.eval("dCbdt(Ca, Cb, Cc) = k1 * Ca - k2 * Cb"),sim.eval("dCcdt(Ca, Cb, Cc) = k2 * Cb"),sim.eval("result = ndsolve([dCadt, dCbdt, dCcdt], [Ca0, Cb0, Cc0], dt, tfinal)");const t=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(t){return t[0]}),n=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(t){return t[0]}),o=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(t){return t[0]});let l=t.length;for(CA=new Array(l),CB=new Array(l),CC=new Array(l),selectivity=new Array(l),i=0;i<t.length;i++){let a=tfinal/l*(i+1);CA[i]=[a,t[i]],CB[i]=[a,n[i]],CC[i]=[a,o[i]],selectivity[i]=[a,CB[i][1]/CC[i][1]]}CA.unshift([0,Cao]),CB.unshift([0,Cbo]),CC.unshift([0,Cco]),selectivity.unshift([0,100])}function windowResized(){clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,resizeCanvas(clientWidth,clientHeight),mainPlot.GPLOT.setOuterDim(clientWidth,clientHeight),mainPlot.GPLOT.setPos(0,0),gui.prototype.setPosition(window.innerWidth/2+clientWidth/2-150,mainPlot.GPLOT.mar[2]+80)}function setup(){let t=createCanvas(clientWidth,clientHeight);t.parent("plotContainer"),mainPlot=new PlotCanvas(this),mainPlot.xLims=[0,tfinal],mainPlot.yLims=[0,2.5],mainPlot.xAxisLabel="time (h)",mainPlot.yAxisLabel=" ",mainPlot.plotTitle="",mainPlot.plotSetup(),gui=createGui("Plot Controls",clientWidth-10,mainPlot.GPLOT.mar[2]+100),gui.newSlider("T",450,480,450,1,"Temperature","K"),gui.newDropdown("page",["concentrations","selectivity"],"Display:"),updateData(),CaFunction=new ArrayPlot(CA),CaFunction.lineColor=color(255,0,0,255),CbFunction=new ArrayPlot(CB),CbFunction.lineColor=color(50,220,0,255),CcFunction=new ArrayPlot(CC),CcFunction.lineColor=color(0,0,255,255),selFunction=new ArrayPlot(selectivity),selFunction.lineColor=color(0,0,0,0),mainPlot.addFuncs(CaFunction,CbFunction,CcFunction,selFunction),noLoop(),windowResized(),window.setTimeout(()=>{windowResized()},2e3)}function draw(){switch(clear(),updateData(),CaFunction.update(CA),CbFunction.update(CB),CcFunction.update(CC),selFunction.update(selectivity),page){case"selectivity":mainPlot.yAxisLabel="selectivity (     /     )",mainPlot.GPLOT.getYAxis().getAxisLabel().setText(mainPlot.yAxisLabel),selFunction.lineColor=color(0,0,0,255),CaFunction.lineColor=color(255,0,0,0),CbFunction.lineColor=color(50,220,0,0),CcFunction.lineColor=color(0,0,255,0);break;default:mainPlot.yAxisLabel="concentration (mol / L)",mainPlot.GPLOT.getYAxis().getAxisLabel().setText(mainPlot.yAxisLabel),selFunction.lineColor=color(0,0,0,0),CaFunction.lineColor=color(255,0,0,255),CbFunction.lineColor=color(50,220,0,255),CcFunction.lineColor=color(0,0,255,255)}mainPlot.plotDraw();let t=tfinal/2,i=selectivity[Math.trunc(map(tfinal/2,0,tfinal,0,tfinal/dt-1))][1]+.1,n=tfinal/6,o=CA[Math.trunc(map(tfinal/6,0,tfinal,0,tfinal/dt-1))][1],l=tfinal/2,a=CB[Math.trunc(map(tfinal/2,0,tfinal,0,tfinal/dt-1))][1],e=5*tfinal/6,C=CC[Math.trunc(map(5*tfinal/6,0,tfinal,0,tfinal/dt-1))][1];mainPlot.labelDraw("selectivity",t,i,selFunction.lineColor,[CENTER,CENTER],!1,[5,1.6]),mainPlot.labelDraw("C",n,o,CaFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("A",n,o,CaFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("C",l,a,CbFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("B",l,a,CbFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("C",e,C,CcFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("C",e,C,CcFunction.lineColor,[LEFT,TOP],"sub"),push(),translate(mainPlot.GPLOT.pos[0]+mainPlot.GPLOT.mar[1],mainPlot.GPLOT.pos[1]+mainPlot.GPLOT.mar[2]+mainPlot.GPLOT.dim[1]),fill(mainPlot.GPLOT.boxBgColor.levels[0],mainPlot.GPLOT.boxBgColor.levels[1],mainPlot.GPLOT.boxBgColor.levels[2],255*selFunction.lineColor._array[3]),noStroke(),rectMode(CENTER),rect(mainPlot.GPLOT.mainLayer.valueToXPlot(t)+3.3*mainPlot.fontSize,mainPlot.GPLOT.mainLayer.valueToYPlot(i),30,55),pop(),mainPlot.subSuperDraw("C","B",t,i,selFunction.lineColor,"sub",0,3.3*mainPlot.fontSize,-.9*mainPlot.fontSize),mainPlot.subSuperDraw("C","C",t,i,selFunction.lineColor,"sub",0,3.3*mainPlot.fontSize,.8*mainPlot.fontSize),mainPlot.drawLine(t,i,3*mainPlot.fontSize,0,selFunction.lineColor,1,4*mainPlot.fontSize,0),mainPlot.yaxisSubSuperDraw("C","B",0,1.4,selFunction.lineColor,"sub",-PI/2),mainPlot.yaxisSubSuperDraw("C","C",0,3.2,selFunction.lineColor,"sub",-PI/2)}var gui,mainPlot,equation,CA,CB,CC,selectivity,clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,T=450,tfinal=15,dt=.1,Cao=2,Cbo=0,Cco=0,page="concentration";const sim=math.parser();