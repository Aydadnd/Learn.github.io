function overText(t,n){return`\\mathrel{\\stackrel{${n}}{${t}}}`}function updateData(){sim.eval("R = 0.008314"),sim.eval(`T = ${T}`),sim.eval(`Ed = ${Ed}`),sim.eval(`Eu = ${Eu}`),sim.eval("kd = 1.22*(10^22)*e^(-Ed/(R*T))"),sim.eval("ku = 3.79*(10^23)*e^(-Eu/(R*T))"),sim.eval(`Na0 = ${Na0}`),sim.eval(`Nb0 = ${Nb0}`),sim.eval(`Nd0 = ${Nd0}`),sim.eval(`Nu0 = ${Nu0}`),sim.eval(`V0 = ${V0}`),sim.eval(`dt = ${dt}`),sim.eval(`tfinal = ${tfinal}`),sim.eval("dNadt(Na, Nb, Nd, Nu, V) = 10 - ((kd * (Na / V) * ((Nb / V) ^ 2)) * V) - ((ku * (Na / V) * (Nb / V)) * V)"),sim.eval("dNbdt(Na, Nb, Nd, Nu, V) = -V * ((kd * (Na / V) * ((Nb / V) ^ 2)) + (ku * (Na / V) * (Nb / V)))"),sim.eval("dNddt(Na, Nb, Nd, Nu, V) = (kd * (Na / V) * ((Nb / V) ^ 2)) * V"),sim.eval("dNudt(Na, Nb, Nd, Nu, V) = (ku * (Na / V) * (Nb / V)) * V"),sim.eval("dVdt(Na, Nb, Nd, Nu, V) = 1"),sim.eval("result = ndsolve([dNadt, dNbdt, dNddt, dNudt, dVdt], [Na0, Nb0, Nd0, Nu0, V0], dt, tfinal)");let t=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(t){return t[0]}),n=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(t){return t[0]}),a=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(t){return t[0]}),e=sim.eval("transpose(concat(transpose(result[:,4]),1))").toArray().map(function(t){return t[0]}),o=t.length;for(NA=new Array(o),NB=new Array(o),ND=new Array(o),NU=new Array(o),i=0;i<o;i++){let l=tfinal/o*(i+1);NA[i]=[l,t[i]],NB[i]=[l,n[i]],ND[i]=[l,a[i]],NU[i]=[l,e[i]]}NA.unshift([0,Na0]),NB.unshift([0,Nb0]),ND.unshift([0,Nd0]),NU.unshift([0,Nu0])}function windowResized(){clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,resizeCanvas(clientWidth,clientHeight),mainPlot.GPLOT.setOuterDim(clientWidth,clientHeight),mainPlot.GPLOT.setPos(0,0),gui.prototype.setPosition(clientWidth,mainPlot.GPLOT.mar[2]+100)}function setup(){titleDOM=document.getElementById("title");let t=createCanvas(clientWidth,clientHeight);t.parent("plotContainer"),mainPlot=new PlotCanvas(this),mainPlot.xLims=[0,tfinal],mainPlot.yLims=[0,100],mainPlot.xAxisLabel="time (min)",mainPlot.yAxisLabel="moles of product",mainPlot.plotTitle="",mainPlot.plotSetup(),gui=createGui("Plot Controls",clientWidth-10,mainPlot.GPLOT.mar[2]+100),gui.newSlider("T",298,370,350,1,"Isothermal Temperature","K"),gui.newSlider("Ed",140,160,150,1,"activation energy<br>(desired)","kJ/mol"),gui.newSlider("Eu",150,170,160,1,"activation energy<br>(undesired)","kJ/mol"),gui.newDropdown("addedto",["A added to B","B added to A"]),gui.newDropdown("plot",["ND and NU","Selectivity (ND/NU)","NA and NB"],"plot: "),updateData(),NaFunction=new ArrayPlot(NA),NaFunction.lineColor=color(255,0,0,255),NbFunction=new ArrayPlot(NB),NbFunction.lineColor=color(50,220,0,255),NdFunction=new ArrayPlot(ND),NdFunction.lineColor=color(0,0,255,255),NuFunction=new ArrayPlot(NU),NuFunction.lineColor=color(0,100,100,255),mainPlot.addFuncs(NaFunction,NbFunction,NdFunction,NuFunction);let n=1e3;setTimeout(function t(){try{titleDOM.innerText=title,MathJax.Hub.Configured(),MathJax.Hub.Register.StartupHook("End",function(){mjready=!0})}catch(a){console.error(a),n<1e4?(n*=1.5,setTimeout(t,n)):console.log("mathjax could not load")}},n);let a=document.getElementsByClassName("qs_main")[0];a.addEventListener("mouseup",t=>{updateJax()}),noLoop()}function draw(){clear(),updateData(),NaFunction.update(NA),NbFunction.update(NB),NdFunction.update(ND),NuFunction.update(NU),NaFunction.lineColor=color(255,0,0,255),NbFunction.lineColor=color(50,220,0,255),NdFunction.lineColor=color(0,0,255,255),NuFunction.lineColor=color(0,100,100,255),mainPlot.plotDraw();let t=tfinal/8,n=NA[Math.trunc(map(tfinal/8,0,tfinal,0,tfinal/dt-1))][1],a=3*tfinal/8,i=NB[Math.trunc(map(3*tfinal/8,0,tfinal,0,tfinal/dt-1))][1],e=5*tfinal/8,o=ND[Math.trunc(map(5*tfinal/8,0,tfinal,0,tfinal/dt-1))][1],l=7*tfinal/8,r=NU[Math.trunc(map(7*tfinal/8,0,tfinal,0,tfinal/dt-1))][1];mainPlot.labelDraw("N",t,n,NaFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("A",t,n,NaFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("N",a,i,NbFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("B",a,i,NbFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("N",e,o,NdFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("D",e,o,NdFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("N",l,r,NuFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("U",l,r,NuFunction.lineColor,[LEFT,TOP],"sub")}function updateJax(){if(mjready){title=`\\mathrm{ A+2B \\rightarrow C \\qquad\\qquad } r = ${k} \\mathrm{ C_{A}C_{B}${1!=n?String("^{"+n+"}"):""} \\;  \\frac{mol}{m^{3}s} } `;var t=MathJax.Hub.getAllJax("title")[0];MathJax.Hub.Queue(["Text",t,title])}}var gui,mainPlot,equation,T,Ed,Eu,NA,NB,ND,NU,NaFunction,NbFunction,NdFunction,NuFunction,n,titleDOM,clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,tfinal=20,dt=.01,Na0=0,Nb0=100,Nd0=0,Nu0=0,V0=10,title=`\\(\\mathrm{ A+B ${overText("\\rightarrow","k_{D}")} D \\qquad\\qquad } \\mathrm{ A+B ${overText("\\rightarrow","k_{U}")} U \\qquad\\qquad } \\)`;let mjready=!1;const sim=math.parser();