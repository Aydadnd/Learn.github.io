function overText(o,t){return`\\mathrel{\\stackrel{${t}}{${o}}}`}function updateData(){function o(o,t,n,i,l){if(AB==ABchoices[0]&&l<=20){const n=10-c*(o/l)*(t/l)**2*l-u*(o/l)*(t/l)*l;return n}{const n=-c*(o/l)*(t/l)**2*l-u*(o/l)*(t/l)*l;return n}}function t(o,t,n,i,l){if(AB==ABchoices[0]||AB==ABchoices[1]&&l>20){const n=-l*(c*(o/l)*(t/l)**2+u*(o/l)*(t/l));return n}{const n=10-l*(c*(o/l)*(t/l)**2+u*(o/l)*(t/l));return n}}function n(o,t,n,i,l){const e=c*(o/l)*(t/l)**2*l;return e}function i(o,t,n,i,l){const e=u*(o/l)*(t/l)*l;return e}function l(o,t,n,i,l){const e=1;return e}const e=.008314;console.log({Ed:Ed,Eu:Eu});const a=Math.exp(-Ed/(e*T)),r=Math.exp(-Eu/(e*T)),c=1.22e22*a,u=3.79*1e23*r;Na0=AB==ABchoices[0]?0:100,Nb0=AB==ABchoices[0]?100:0;let s=new RangeSolve2({f:[o,t,n,i,l],yi:[Na0,Nb0,Nd0,Nu0,V0],tinitial:0,dt:dt,tfinal:tfinal}).calcAll();NA=s[0],NB=s[1],ND=s[2],NU=s[3],S=new Array(ND.length),S[0]=[ND[1][0],ND[1][1]/NU[1][1]];for(let o=1;o<S.length;o++)S[o]=[ND[o][0],ND[o][1]/NU[o][1]];const m=plotChoices.indexOf(plot);if(1==m){let o=!1,t=[];S.forEach(o=>{t.push(o[1])});const n=t.reduce(function(o,t){return Math.max(o,t)});o=n>=mainPlot.yLims[1]||n<=.1*mainPlot.yLims[1],o&&(mainPlot.yLims[1]=Math.ceil(2*n),mainPlot.plotSetup())}else 100!=mainPlot.yLims[1]&&(mainPlot.yLims[1]=100,mainPlot.plotSetup())}function windowResized(){clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio;let o=document.getElementById("plotContainer").getBoundingClientRect(),t=o.left+o.width+5;resizeCanvas(clientWidth,clientHeight),mainPlot.GPLOT.setOuterDim(clientWidth,clientHeight),mainPlot.GPLOT.setPos(0,0),gui.prototype.setPosition(t,mainPlot.GPLOT.mar[2]+100)}function setup(){titleDOM=document.getElementById("title");let o=createCanvas(clientWidth,clientHeight);math.import({RangeSolve2:RangeSolve2}),o.parent("plotContainer"),mainPlot=new PlotCanvas(this),mainPlot.xLims=[0,tfinal],mainPlot.yLims=[0,100],mainPlot.xAxisLabel="time (min)",mainPlot.yAxisLabel="moles of product",mainPlot.plotTitle="",mainPlot.plotSetup(),gui=createGui("Plot Controls",clientWidth-10,mainPlot.GPLOT.mar[2]+100),gui.newSlider("T",298,370,350,1,"Isothermal Temperature","K"),gui.newSlider("Ed",140,160,150,1,"activation energy<br>(desired)","kJ/mol"),gui.newSlider("Eu",150,170,160,1,"activation energy<br>(undesired)","kJ/mol"),gui.newDropdown("AB",[`${ABchoices[0]}`,`${ABchoices[1]}`]),gui.newDropdown("plot",[`${plotChoices[0]}`,`${plotChoices[1]}`,`${plotChoices[2]}`,`${plotChoices[3]}`],"plot: "),updateData(),NaFunction=new ArrayPlot(NA),NaFunction.lineColor=color(255,0,0,255),NbFunction=new ArrayPlot(NB),NbFunction.lineColor=color(50,220,0,255),NdFunction=new ArrayPlot(ND),NdFunction.lineColor=color(0,0,255,255),NuFunction=new ArrayPlot(NU),NuFunction.lineColor=color(0,100,100,255),SFunction=new ArrayPlot(S),SFunction.lineColor=color(0,0,0,255),mainPlot.addFuncs(NaFunction,NbFunction,NdFunction,NuFunction,SFunction);let t=1e3;setTimeout(function o(){try{titleDOM.innerText=title,MathJax.Hub.Configured(),MathJax.Hub.Register.StartupHook("End",function(){mjready=!0})}catch(n){console.error(n),t<1e4?(t*=1.5,setTimeout(o,t)):console.log("mathjax could not load")}},t),noLoop(),windowResized()}function draw(){clear(),updateData(),NaFunction.update(NA),NbFunction.update(NB),NdFunction.update(ND),NuFunction.update(NU),SFunction.update(S);let o=0,t=0,n=0,i=0,l=tfinal/2;const e=plotChoices.indexOf(plot);switch(e){case 0:n=tfinal/3,i=2*tfinal/3,mainPlot.yAxisLabel="moles of products",mainPlot.GPLOT.getYAxis().getAxisLabel().setText(mainPlot.yAxisLabel),NaFunction.lineColor=color(255,0,0,0),NbFunction.lineColor=color(50,220,0,0),NdFunction.lineColor=color(0,0,255,255),NuFunction.lineColor=color(0,100,100,255),SFunction.lineColor=color(0,0,0,0);break;case 1:l=tfinal/2,mainPlot.yAxisLabel="selectivity (     /     )",mainPlot.GPLOT.getYAxis().getAxisLabel().setText(mainPlot.yAxisLabel),NaFunction.lineColor=color(255,0,0,0),NbFunction.lineColor=color(50,220,0,0),NdFunction.lineColor=color(0,0,255,0),NuFunction.lineColor=color(0,100,100,0),SFunction.lineColor=color(0,0,0,255);break;case 2:o=tfinal/3,t=2*tfinal/3,mainPlot.yAxisLabel="moles of reactants",mainPlot.GPLOT.getYAxis().getAxisLabel().setText(mainPlot.yAxisLabel),NaFunction.lineColor=color(255,0,0,255),NbFunction.lineColor=color(50,220,0,255),NdFunction.lineColor=color(0,0,255,0),NuFunction.lineColor=color(0,100,100,0),SFunction.lineColor=color(0,0,0,0);break;case 3:o=tfinal/6,t=2*tfinal/6,n=3*tfinal/6,i=4*tfinal/6,l=5*tfinal/6,mainPlot.yAxisLabel="moles of reactants (or selectivity)",mainPlot.GPLOT.getYAxis().getAxisLabel().setText(mainPlot.yAxisLabel),NaFunction.lineColor=color(255,0,0,255),NbFunction.lineColor=color(50,220,0,255),NdFunction.lineColor=color(0,0,255,255),NuFunction.lineColor=color(0,100,100,255),SFunction.lineColor=color(0,0,0,255)}mainPlot.plotDraw();const a=NA.findIndex(t=>Math.abs(t[0]-o)<dt),r=NA[a][1],c=NB.findIndex(o=>Math.abs(o[0]-t)<dt),u=NB[c][1],s=ND.findIndex(o=>Math.abs(o[0]-n)<dt),m=ND[s][1],d=NU.findIndex(o=>Math.abs(o[0]-i)<dt),N=NU[d][1],P=S.findIndex(o=>Math.abs(o[0]-l)<dt),h=S[P][1];mainPlot.labelDraw("N",o,r,NaFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("A",o,r,NaFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("N",t,u,NbFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("B",t,u,NbFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("N",n,m,NdFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("D",n,m,NdFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("N",i,N,NuFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("U",i,N,NuFunction.lineColor,[LEFT,TOP],"sub"),push(),translate(mainPlot.GPLOT.pos[0]+mainPlot.GPLOT.mar[1],mainPlot.GPLOT.pos[1]+mainPlot.GPLOT.mar[2]+mainPlot.GPLOT.dim[1]),fill(mainPlot.GPLOT.boxBgColor.levels[0],mainPlot.GPLOT.boxBgColor.levels[1],mainPlot.GPLOT.boxBgColor.levels[2],255*SFunction.lineColor._array[3]),noStroke(),rectMode(CENTER),rect(mainPlot.GPLOT.mainLayer.valueToXPlot(l),mainPlot.GPLOT.mainLayer.valueToYPlot(h),30,55),pop(),mainPlot.subSuperDraw("N","D",l,h,SFunction.lineColor,"sub",0,0,-.9*mainPlot.fontSize),mainPlot.subSuperDraw("N","U",l,h,SFunction.lineColor,"sub",0,0,.8*mainPlot.fontSize),mainPlot.drawLine(l,h,3*mainPlot.fontSize,0,SFunction.lineColor,1,.75*mainPlot.fontSize,0),1==e&&(mainPlot.yaxisSubSuperDraw("N","D",0,1.4,SFunction.lineColor,"sub",-PI/2),mainPlot.yaxisSubSuperDraw("N","U",0,3.2,SFunction.lineColor,"sub",-PI/2))}function updateJax(){if(mjready){title="";var o=MathJax.Hub.getAllJax("title")[0];MathJax.Hub.Queue(["Text",o,title])}}var gui,mainPlot,equation,T,Ed,Eu,NA,NB,ND,NU,S,NaFunction,NbFunction,NdFunction,NuFunction,n,titleDOM,clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,tfinal=20,dt=.1,ABchoices=["A added to B","B added to A"],AB=ABchoices[0],plotChoices=["ND and NU","Selectivity (ND/NU)","NA and NB","Show All"],plot=plotChoices[0],Na0=0,Nb0=100,Nd0=0,Nu0=0,V0=10,title=`\\(\\mathrm{ A+B ${overText("\\rightarrow","k_{D}")} D \\qquad\\qquad } \\mathrm{ A+B ${overText("\\rightarrow","k_{U}")} U \\qquad\\qquad } \\)`;let mjready=!1;const sim=math.parser();