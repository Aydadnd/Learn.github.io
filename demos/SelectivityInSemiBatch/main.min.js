function updateData(){sim.eval(`Ca0 = ${xA0}`),sim.eval(`Cb0 = ${1-xA0}`),sim.eval("Cc0 = 0"),sim.eval(`k = ${k}`),sim.eval(`u = ${u}`),sim.eval(`n = ${n}`),sim.eval(`vfinal = ${vfinal}`),sim.eval(`dv = ${dv}`),sim.eval("dCadv(Ca, Cb, Cc) = -k * Ca * (Cb ^ n) / u"),sim.eval("dCbdv(Ca, Cb, Cc) = -2 * k * Ca * (Cb ^ n) / u"),sim.eval("dCcdv(Ca, Cb, Cc) = k * Ca * (Cb ^ n) / u"),sim.eval("result = ndsolve([dCadv, dCbdv, dCcdv], [Ca0, Cb0, Cc0], dv, vfinal)");let t,a,e,l,o=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(n){return n[0]}),r=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(n){return n[0]}),s=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(n){return n[0]}),c=-1;for(let n=0;n<o.length;n++){if(o[n]<=0){c=n,t="Ca";break}if(r[n]<=0){c=n,t="Cb";break}}if(c>=0){sim.eval(`Ca0 = ${"Ca"==t?0:xA0-(1-xA0)/2}`),sim.eval(`Cb0 = ${"Cb"==t?0:1-2*xA0}`),sim.eval(`Cc0 = ${"Ca"==t?xA0:(1-xA0)/2}`),sim.eval(`k = ${k}`),sim.eval(`u = ${u}`),sim.eval(`n = ${n}`),sim.eval(`vfinal = ${vfinal*(1-c/o.length)}`),sim.eval(`dv = ${dv}`),sim.eval("dCadv(Ca, Cb, Cc) = 0"),sim.eval("dCbdv(Ca, Cb, Cc) = 0"),sim.eval("dCcdv(Ca, Cb, Cc) = 0"),sim.eval("result = ndsolve([dCadv, dCbdv, dCcdv], [Ca0, Cb0, Cc0], dv, vfinal)"),a=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(n){return n[0]}),e=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(n){return n[0]}),l=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(n){return n[0]});for(let n=0;n<a.length;n++)o[c+n]=a[n],r[c+n]=e[n],s[c+n]=l[n]}let d=o.length;for(FA=new Array(d),FB=new Array(d),FC=new Array(d),i=0;i<FA.length;i++){let n=vfinal/d*(i+1);FA[i]=[n,o[i]*u],FB[i]=[n,r[i]*u],FC[i]=[n,s[i]*u]}FA.unshift([0,xA0*u]),FB.unshift([0,(1-xA0)*u]),FC.unshift([0,0]),adjustUnits()}function adjustUnits(){switch(n){case 0:window.kInnerHTML='<span id="kunits">s<sup>-1</sup></span>',kunits.innerHTML=window.kInnerHTML;break;case 1:window.kInnerHTML='<span id="kunits">m<sup>3</sup>/(mol s)</span>',kunits.innerHTML=window.kInnerHTML;break;case 2:window.kInnerHTML='<span id="kunits">m<sup>6</sup>/(mol<sup>2</sup> s)</span>',kunits.innerHTML=window.kInnerHTML}}function windowResized(){clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,resizeCanvas(clientWidth,clientHeight),mainPlot.GPLOT.setOuterDim(clientWidth,clientHeight),mainPlot.GPLOT.setPos(0,0),gui.prototype.setPosition(clientWidth,mainPlot.GPLOT.mar[2]+100)}function setup(){titleDOM=document.getElementById("title");let n=createCanvas(clientWidth,clientHeight);n.parent("plotContainer"),mainPlot=new PlotCanvas(this),mainPlot.xLims=[0,vfinal],mainPlot.yLims=[0,1],mainPlot.xAxisLabel="volume (mÂ³)",mainPlot.yAxisLabel="molar flow rate (mol / s)",mainPlot.plotTitle="",mainPlot.plotSetup(),gui=createGui("Plot Controls",clientWidth-10,mainPlot.GPLOT.mar[2]+100),gui.newSlider("T",298,370,350,1,"Isothermal Temperature","K"),gui.newSlider("Ed",140,160,150,1,"activation energy<br>(desired)","kJ/mol"),gui.newSlider("Eu",150,170,160,1,"activation energy<br>(undesired)","kJ/mol"),gui.newDropdown("addedto",["A added to B","B added to A"]),gui.newDropdown("plot",["ND and NU","Selectivity (ND/NU)","NA and NB"],"plot: "),updateData(),FaFunction=new ArrayPlot(FA),FaFunction.lineColor=color(255,0,0,255),FbFunction=new ArrayPlot(FB),FbFunction.lineColor=color(50,220,0,255),FcFunction=new ArrayPlot(FC),FcFunction.lineColor=color(0,0,255,255),mainPlot.addFuncs(FaFunction,FbFunction,FcFunction);let t=1e3;setTimeout(function n(){try{titleDOM.innerText=title,MathJax.Hub.Configured(),MathJax.Hub.Register.StartupHook("End",function(){mjready=!0})}catch(a){console.error(a),t<1e4?(t*=1.5,setTimeout(n,t)):console.log("mathjax could not load")}},t);let a=document.getElementsByClassName("qs_main")[0];a.addEventListener("mouseup",n=>{updateJax()}),noLoop()}function draw(){clear(),updateData(),FaFunction.update(FA),FbFunction.update(FB),FcFunction.update(FC),FaFunction.lineColor=color(255,0,0,255),FbFunction.lineColor=color(50,220,0,255),FcFunction.lineColor=color(0,0,255,255),mainPlot.plotDraw();let n=vfinal/6,t=FA[Math.trunc(map(vfinal/6,0,vfinal,0,vfinal/dv-1))][1],a=vfinal/2,i=FB[Math.trunc(map(vfinal/2,0,vfinal,0,vfinal/dv-1))][1],e=5*vfinal/6,l=FC[Math.trunc(map(5*vfinal/6,0,vfinal,0,vfinal/dv-1))][1];mainPlot.labelDraw("F",n,t,FaFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("A",n,t,FaFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("F",a,i,FbFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("B",a,i,FbFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("F",e,l,FcFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("C",e,l,FcFunction.lineColor,[LEFT,TOP],"sub")}function updateJax(){if(mjready){title=`\\mathrm{ A+2B \\rightarrow C \\qquad\\qquad } r = ${k} \\mathrm{ C_{A}C_{B}${1!=n?String("^{"+n+"}"):""} \\;  \\frac{mol}{m^{3}s} } `;var t=MathJax.Hub.getAllJax("title")[0];MathJax.Hub.Queue(["Text",t,title])}}var gui,mainPlot,equation,FA,FB,FC,xA0,k,n,titleDOM,clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,vfinal=5,dv=.1,u=1,title="\\(\\mathrm{ A+2B \\rightarrow C \\qquad\\qquad } r = 0.50 \\mathrm{ C_{A}C_{B} \\;  \\frac{mol}{m^{3}s} } \\)";let kunits,mjready=!1;window.kInnerHTML='<span id="kunits">m<sup>3</sup>/(mol s)</span>';const sim=math.parser();