function updateData(){sim.eval(`Ca0 = ${xA0}`),sim.eval(`Cb0 = ${1-xA0}`),sim.eval("Cc0 = 0"),sim.eval(`k = ${k}`),sim.eval(`u = ${u}`),sim.eval(`n = ${n}`),sim.eval(`vfinal = ${vfinal}`),sim.eval(`dv = ${dv}`),sim.eval("dCadv(Ca, Cb, Cc) = -k * Ca * (Cb ^ n) / u"),sim.eval("dCbdv(Ca, Cb, Cc) = -2 * k * Ca * (Cb ^ n) / u"),sim.eval("dCcdv(Ca, Cb, Cc) = k * Ca * (Cb ^ n) / u"),sim.eval("result = ndsolve([dCadv, dCbdv, dCcdv], [Ca0, Cb0, Cc0], dv, vfinal)");let t,a,e,l,o=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(t){return t[0]}),r=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(t){return t[0]}),s=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(t){return t[0]}),c=-1;for(let a=0;a<o.length;a++){if(o[a]<=0){c=a,t="Ca";break}if(r[a]<=0){c=a,t="Cb";break}}if(c>=0){sim.eval(`Ca0 = ${"Ca"==t?0:xA0-(1-xA0)/2}`),sim.eval(`Cb0 = ${"Cb"==t?0:1-2*xA0}`),sim.eval(`Cc0 = ${"Ca"==t?xA0:(1-xA0)/2}`),sim.eval(`k = ${k}`),sim.eval(`u = ${u}`),sim.eval(`n = ${n}`),sim.eval(`vfinal = ${vfinal*(1-c/o.length)}`),sim.eval(`dv = ${dv}`),sim.eval("dCadv(Ca, Cb, Cc) = 0"),sim.eval("dCbdv(Ca, Cb, Cc) = 0"),sim.eval("dCcdv(Ca, Cb, Cc) = 0"),sim.eval("result = ndsolve([dCadv, dCbdv, dCcdv], [Ca0, Cb0, Cc0], dv, vfinal)"),a=sim.eval("transpose(concat(transpose(result[:,1]),1))").toArray().map(function(t){return t[0]}),e=sim.eval("transpose(concat(transpose(result[:,2]),1))").toArray().map(function(t){return t[0]}),l=sim.eval("transpose(concat(transpose(result[:,3]),1))").toArray().map(function(t){return t[0]});for(let t=0;t<a.length;t++)o[c+t]=a[t],r[c+t]=e[t],s[c+t]=l[t]}let m=o.length;for(FA=new Array(m),FB=new Array(m),FC=new Array(m),i=0;i<FA.length;i++){let t=vfinal/m*(i+1);FA[i]=[t,o[i]*u],FB[i]=[t,r[i]*u],FC[i]=[t,s[i]*u]}FA.unshift([0,xA0*u]),FB.unshift([0,(1-xA0)*u]),FC.unshift([0,0])}function windowResized(){clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,resizeCanvas(clientWidth,clientHeight),mainPlot.GPLOT.setOuterDim(clientWidth,clientHeight),mainPlot.GPLOT.setPos(0,0),gui.prototype.setPosition(clientWidth,mainPlot.GPLOT.mar[2]+100)}function setup(){titleDOM=document.getElementById("title");let t=createCanvas(clientWidth,clientHeight);t.parent("plotContainer"),mainPlot=new PlotCanvas(this),mainPlot.xLims=[0,vfinal],mainPlot.yLims=[0,1],mainPlot.xAxisLabel="volume (mÂ³)",mainPlot.yAxisLabel="molar flow rate (mol / s)",mainPlot.plotTitle="",mainPlot.plotSetup(),gui=createGui("Plot Controls",clientWidth-10,mainPlot.GPLOT.mar[2]+100),gui.newSlider("xA0",0,1,.5,.01,"inlet mole fraction A"),gui.newSlider("k",0,1,.5,.01,"reaction rate constant <i>k</i>",'<span id="kunits">L / mol</span>'),gui.newSlider("n",0,2,1,1,"reaction order of B"),updateData(),FaFunction=new ArrayPlot(FA),FaFunction.lineColor=color(255,0,0,255),FbFunction=new ArrayPlot(FB),FbFunction.lineColor=color(50,220,0,255),FcFunction=new ArrayPlot(FC),FcFunction.lineColor=color(0,0,255,255),mainPlot.addFuncs(FaFunction,FbFunction,FcFunction);let a=1e3;setTimeout(function t(){try{titleDOM.innerText=title,MathJax.Hub.Configured(),MathJax.Hub.Register.StartupHook("End",function(){mjready=!0})}catch(n){console.error(n),a<1e4?(a*=1.5,setTimeout(t,a)):console.log("mathjax could not load")}},a);let n=document.getElementsByClassName("qs_main")[0];n.addEventListener("mouseup",t=>{updateJax()}),noLoop()}function draw(){clear(),updateData(),FaFunction.update(FA),FbFunction.update(FB),FcFunction.update(FC),FaFunction.lineColor=color(255,0,0,255),FbFunction.lineColor=color(50,220,0,255),FcFunction.lineColor=color(0,0,255,255),mainPlot.plotDraw();let t=vfinal/6,a=FA[Math.trunc(map(vfinal/6,0,vfinal,0,vfinal/dv-1))][1],n=vfinal/2,i=FB[Math.trunc(map(vfinal/2,0,vfinal,0,vfinal/dv-1))][1],e=5*vfinal/6,l=FC[Math.trunc(map(5*vfinal/6,0,vfinal,0,vfinal/dv-1))][1];mainPlot.labelDraw("F",t,a,FaFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("A",t,a,FaFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("F",n,i,FbFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("B",n,i,FbFunction.lineColor,[LEFT,TOP],"sub"),mainPlot.labelDraw("F",e,l,FcFunction.lineColor,[RIGHT,CENTER],!1,[2,1.8]),mainPlot.labelDraw("C",e,l,FcFunction.lineColor,[LEFT,TOP],"sub")}function updateJax(){if(mjready){title=`\\mathrm{ A+2B \\rightarrow C \\qquad\\qquad } r = ${k} \\mathrm{ C_{A}C_{B}${1!=n?String("^{"+n+"}"):""} \\;  \\frac{mol}{m^{3}s} } `;var t=MathJax.Hub.getAllJax("title")[0];MathJax.Hub.Queue(["Text",t,title])}}var gui,mainPlot,equation,FA,FB,FC,xA0,k,n,titleDOM,clientWidth=Math.min(window.innerWidth-200,600),aspRatio=1,clientHeight=clientWidth*aspRatio,vfinal=5,dv=.1,u=1,title="\\(\\mathrm{ A+2B \\rightarrow C \\qquad\\qquad } r = 0.50 \\mathrm{ C_{A}C_{B} \\;  \\frac{mol}{m^{3}s} } \\)";let mjready=!1;const sim=math.parser();