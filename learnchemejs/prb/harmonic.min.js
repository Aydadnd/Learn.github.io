function hermites(t,e){let s={0:"1",1:`${2*e}`,2:`${4*Math.pow(e,2)-2}`,3:`${-12*e+8*Math.pow(e,3)}`,4:`${12-48*Math.pow(e,2)+16*Math.pow(e,4)}`,5:`${120*e-160*Math.pow(e,3)+32*Math.pow(e,5)}`,6:`${720*Math.pow(e,2)-120-480*Math.pow(e,4)+64*Math.pow(e,6)}`,7:`${-1680*e+3360*Math.pow(e,3)-1344*Math.pow(e,5)+128*Math.pow(e,7)}`,8:`${1680-13440*Math.pow(e,2)+13440*Math.pow(e,4)-3584*Math.pow(e,6)+256*Math.pow(e,8)}`,9:`${30240*e-80640*Math.pow(e,3)+48384*Math.pow(e,5)-9216*Math.pow(e,7)+512*Math.pow(e,9)}`,10:`${302400*Math.pow(e,2)-30240-403200*Math.pow(e,4)+161280*Math.pow(e,6)-23040*Math.pow(e,8)+1024*Math.pow(e,10)}`,11:`${-665280*e+2217600*Math.pow(e,3)-1774080*Math.pow(e,5)+506880*Math.pow(e,7)-56320*Math.pow(e,9)+2048*Math.pow(e,11)}`,12:`${665280-7983360*Math.pow(e,2)+13305600*Math.pow(e,4)-7096320*Math.pow(e,6)+1520640*Math.pow(e,8)-135168*Math.pow(e,10)+4096*Math.pow(e,12)}`,13:`${17297280*e-69189120*Math.pow(e,3)+69189120*Math.pow(e,5)-26357760*Math.pow(e,7)+4392960*Math.pow(e,9)-319488*Math.pow(e,11)+8192*Math.pow(e,13)}`,14:`${242161920*Math.pow(e,2)-17297280-484323840*Math.pow(e,4)+322882560*Math.pow(e,6)-92252160*Math.pow(e,8)+12300288*Math.pow(e,10)-745472*Math.pow(e,12)+16384*Math.pow(e,14)}`,15:`${-518918400*e+2421619200*Math.pow(e,3)-2905943040*Math.pow(e,5)+1383782400*Math.pow(e,7)-307507200*Math.pow(e,9)+33546240*Math.pow(e,11)-1720320*Math.pow(e,13)+32768*Math.pow(e,15)}`,16:`${518918400-8302694400*Math.pow(e,2)+19372953600*Math.pow(e,4)-15498362880*Math.pow(e,6)+5535129600*Math.pow(e,8)-984023040*Math.pow(e,10)+89456640*Math.pow(e,12)-3932160*Math.pow(e,14)+65536*Math.pow(e,16)}`,17:`${17643225600*e-94097203200*Math.pow(e,3)+131736084480*Math.pow(e,5)-75277762560*Math.pow(e,7)+20910489600*Math.pow(e,9)-3041525760*Math.pow(e,11)+233963520*Math.pow(e,13)-8912896*Math.pow(e,15)+131072*Math.pow(e,17)}`,18:`${317578060800*Math.pow(e,2)-17643225600-846874828800*Math.pow(e,4)+790416506880*Math.pow(e,6)-338749931520*Math.pow(e,8)+75277762560*Math.pow(e,10)-9124577280*Math.pow(e,12)+601620480*Math.pow(e,14)-20054016*Math.pow(e,16)+262144*Math.pow(e,18)}`,19:`${-670442572800*e+4022655436800*Math.pow(e,3)-6436248698880*Math.pow(e,5)+4290832465920*Math.pow(e,7)-1430277488640*Math.pow(e,9)+260050452480*Math.pow(e,11)-26671841280*Math.pow(e,13)+1524105216*Math.pow(e,15)-44826624*Math.pow(e,17)+524288*Math.pow(e,19)}`,20:`${670442572800-0xc31fdd3f000*Math.pow(e,2)+40226554368e3*Math.pow(e,4)-42908324659200*Math.pow(e,6)+21454162329600*Math.pow(e,8)-5721109954560*Math.pow(e,10)+866834841600*Math.pow(e,12)-76205260800*Math.pow(e,14)+3810263040*Math.pow(e,16)-99614720*Math.pow(e,18)+1048576*Math.pow(e,20)}`};return s[t]}import{GraphCanvas}from"../src/GraphCanvas.js";import{hsvToRgb}from"../src/hsvToRgb.js";import{linspace}from"../src/sky-helpers.js";import{Modal}from"../src/Modal.js";import{modalFill}from"../src/modalFill.js";import{scale}from"../src/scaleApp.js";class Sim{constructor(){this.defineGlobals(),this.insertPageElements(),this.attachListeners(),window.setInterval(this.nextFrame.bind(this),1e3/this.FPS),this.init()}init(){this.getCoefficients(),this.getNs(),this.getMass(),this.getKF(),this.T-=this.TSTEP,this.update();var t=[];t.push(modalFill(this.modalDetails,"../html/modalHTML/harmonicDetailsContent.html.txt")),t.push(modalFill(this.modalDirections,"../html/modalHTML/harmonicDirectionsContent.html.txt")),t.push(modalFill(this.modalAbout,"../html/modalHTML/harmonicAboutContent.html.txt"));const e=this.modalDetails,s=this.modalDirections;Promise.all(t).then(function(){MathJax.Hub.Configured()}).catch(()=>{console.log("MathJax Not Yet Loaded ...");let t=1e3;setTimeout(function i(){try{MathJax.Hub.Configured()}catch(h){console.error(h),t<1e4?(t*=1.5,setTimeout(i,t)):(modalFill(e,"../html/modalHTML/errorText.html.txt"),modalFill(s,"../html/modalHTML/errorText.html.txt"))}},t)}),this.scaleBody(this.SCALE)}defineGlobals(){this.RUNNING=!1,this.FPS=60,this.T=0,this.TSTEP=.1/this.FPS,this.graphWidth=420,this.graphHeight=280,this.rightGraphHeight=2.5*this.graphHeight,this.graphLeft=30,this.graphRight=25,this.graphTop=10,this.graphBottom=60,this.xbounds=[-400,400],this.MAXCOEFFICIENTS=6,this.NS=linspace(0,this.MAXCOEFFICIENTS-1,this.MAXCOEFFICIENTS,!0),this.POINTS=500,this.XS=linspace(this.xbounds[0],this.xbounds[1],this.POINTS+1,!0),this.Yrange=[0,10],this.HS=[],this.KF=20,this.M=.01,this.PROBS=[],this.RES=[],this.IMS=[],this.SCALE=Math.min(1,window.innerWidth/1e3),this.detailsContent="",this.directionsContent="",this.aboutContent="",this.modalDetails=new Modal({modalid:"modal-details",modalclass:"modal moveUp",headerstyle:"",header:"Details",contentstyle:"",content:this.detailsContent,showing:!1}),this.modalDirections=new Modal({modalid:"modal-directions",modalclass:"modal moveUp",headerstyle:"",header:"Directions",contentstyle:"",content:this.directionsContent,showing:!1}),this.modalAbout=new Modal({modalid:"modal-about",modalclass:"modal moveUp",headerstyle:"",header:"About",contentstyle:"",content:this.aboutContent,showing:!1})}insertPageElements(){let t='<div id="page">';t+='<div class="navbar">',t+="<div class='zoom'><img src='../../media/magPlus.png' width='30' id='zoomIn' class='buttonSmall'></img><img src='../../media/magMinus.png' width='30' id='zoomOut' class='buttonSmall'></img></div>",t+="<button id='details' class='buttonMed'>details</button>",t+="<button id='directions' class='buttonMed'>directions</button>",t+="<button id='about' class='buttonMed'>about</button>",t+="</div>",t+='<div class="row">',t+='<div id="left" class="column"></div>',t+='<div id="right" class="column"></div>',t+="</div>",t+="</div>",document.body.insertAdjacentHTML("beforeend",t),t='<div id="coefficients">',t+="<table>",t+="<th>n</th><th>C<sub>n</sub></th>";for(let e=1;e<this.MAXCOEFFICIENTS+1;e++)t+="<tr>",t+=`<td class="table dark"><input id="n-${e}" class="tableinput" value="${this.NS[e-1]}" placeholder="${e}"></input></td>`,t+=`<td class="table light"><input id="cn-${e}" class="tableinput" value="${1==e?1:0}" placeholder="0" tabindex="${e}"></input></td>`,t+="</tr>";t+="</table>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="buttons">',t+="<button id='resetc'>reset t = 0</button>",t+="<button id='reset'>reset defaults</button>",t+="<button id='togglec'>start/stop</button>",t+="<br>",t+="<button id='measure'>measure E</button>",t+="<button id='integrate'>integrate</button>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="integral">',t+="<table>",t+="<th>x<sub>1</sub></th><th>x<sub>2</sub></th><th>integral</th>",t+='<tr><td><input id="x1" class="tableinput" value="-0.5" placeholder="0"></input></td>',t+='<td><input id="x2" class="tableinput" value="0.5" placeholder="0"></input></td>',t+='<td><input id="int" class="tableinput" placeholder="-" readonly></input></td>',t+="</tr></table>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="sliders" class="row">',t+='<div class="sliderdiv">',t+='<p id="spanmass" class="sliderp">Mass</p>',t+='<input type="range" min="1" max="100" value="50" class="slider" id="sldmass">',t+="</div>",t+='<div class="sliderdiv">',t+='<p id="spankf" class="sliderp">force constant k<sub>f</sub>&nbsp</p>',t+='<input type="range" min="1" max="100" value="50" class="slider" id="sldkf">',t+="</div>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t);const e={graphwidth:this.graphWidth,graphheight:this.rightGraphHeight,padding:{left:this.graphLeft+50,bottom:this.graphBottom,top:this.graphTop,right:this.graphRight},graphbackground:"white",axesbackground:"white",x:{label:"x - x<sub>0</sub> (pm)",min:this.xbounds[0],max:this.xbounds[1],majortick:Number((this.xbounds[1]-this.xbounds[0])/4).toFixed(2),minortick:Number((this.xbounds[1]-this.xbounds[0])/16),gridline:this.xbounds[1]},y:{label:"energy (eV)",min:this.Yrange[0],max:this.Yrange[1],majortick:Number.parseInt(Math.trunc((this.Yrange[1]-this.Yrange[0])/7)),minortick:Number.parseInt(Math.trunc((this.Yrange[1]-this.Yrange[0])/7))/4,gridline:this.Yrange[1]}},s={graphwidth:this.graphWidth,graphheight:this.graphHeight,padding:{left:this.graphLeft+50,bottom:this.graphBottom,top:this.graphTop,right:this.graphRight},graphbackground:"white",axesbackground:"white",x:{label:"x - x<sub>0</sub> (pm)",min:this.xbounds[0],max:this.xbounds[1],majortick:Number((this.xbounds[1]-this.xbounds[0])/4).toFixed(2),minortick:Number((this.xbounds[1]-this.xbounds[0])/16),gridline:this.xbounds[1]},y:{label:"ψ (pm <sup>-1/2</sup>)",min:-.3,max:.3,majortick:.1,minortick:.1,gridline:.3}};document.getElementById("right").insertAdjacentHTML("beforeend",'<span class="graphtitle">Energy and Probability Density |ψ|² (=ψ*ψ)</span>'),this.densitygc=new GraphCanvas("density-gc","right",{graphinfo:e}),document.getElementById("left").insertAdjacentHTML("beforeend",'<span class="graphtitle">Real & Imaginary Components</span>'),this.componentgc=new GraphCanvas("component-gc","left",{graphinfo:s})}attachListeners(){document.getElementById("togglec").addEventListener("click",()=>this.toggleRunning()),document.getElementById("resetc").addEventListener("click",()=>this.resetTime()),document.getElementById("reset").addEventListener("click",()=>location.reload()),document.getElementById("measure").addEventListener("click",()=>this.measureE()),document.getElementById("integrate").addEventListener("click",()=>this.integrate());for(let t=1;t<=this.MAXCOEFFICIENTS;t++)document.getElementById(`n-${t}`).addEventListener("input",()=>this.getNs()),document.getElementById(`cn-${t}`).addEventListener("input",()=>this.getCoefficients());document.getElementById("sldmass").addEventListener("input",()=>this.getMass()),document.getElementById("sldkf").addEventListener("input",()=>this.getKF()),document.getElementById("details").addEventListener("click",()=>this.modalDetails.show()),document.getElementById("directions").addEventListener("click",()=>this.modalDirections.show()),document.getElementById("about").addEventListener("click",()=>this.modalAbout.show()),document.getElementById("zoomIn").addEventListener("click",()=>{this.SCALE*=1.125,this.scaleBody(this.SCALE)}),document.getElementById("zoomOut").addEventListener("click",()=>{this.SCALE/=1.125,this.scaleBody(this.SCALE)})}nextFrame(){this.RUNNING&&this.update()}update(){this.T+=this.TSTEP,this.calculatePsi(),this.clearGraphs(),this.drawGraphs()}calculatePsi(){this.PSI=[],this.PROBS=[],this.RES=[],this.IMS=[];const t=this.NS.map(t=>(t+.5)*math.sqrt(this.KF/this.M)),e=t.map(t=>math.exp(math.complex(0,-t*this.T))),s=1e-12,i=1,h=5.08716e-11,a=math.pow(i*i/(this.M*this.KF),.25)*h,o=this.XS.map(t=>t/a*s),n=o.map(t=>math.exp(-.5*math.pow(t,2)));for(let t=0;t<this.coefficients.length;t++){const i=math.divide(1,math.sqrt(math.prod(a,math.pow(2,this.NS[t]),math.factorial(this.NS[t]),math.sqrt(math.PI))));for(let h=0;h<this.XS.length;h++){const a=o[h],d=hermites(this.NS[t],a),l=n[h];0==t?(this.PSI.push(math.prod(this.scaledcoefficients[t],i,d,l,math.sqrt(s))),this.PSI[h]=math.complex(math.prod(this.PSI[h],math.re(e[t])),math.prod(this.PSI[h],math.im(e[t]))),this.PROBS.push(math.re(math.prod(this.PSI[h],math.conj(this.PSI[h])))),this.RES.push(math.re(this.PSI[h])),this.IMS.push(math.im(this.PSI[h]))):(this.PSI[h].re+=math.prod(this.scaledcoefficients[t],i,d,l,math.re(e[t]),math.sqrt(s)),this.PSI[h].im+=math.prod(this.scaledcoefficients[t],i,d,l,math.im(e[t]),math.sqrt(s)),this.RES[h]=math.re(this.PSI[h]),this.IMS[h]=math.im(this.PSI[h]),this.PROBS[h]+=math.re(math.prod(this.PSI[h],math.conj(this.PSI[h]))))}}this.ENERGY=0;for(let t=0;t<this.MAXCOEFFICIENTS;t++){const e=.0161538,s=(this.NS[t]+.5)*math.sqrt(this.KF/this.M)*e;this.ENERGY+=s*this.scaledcoefficients[t]}const d=(this.Yrange[1]-this.Yrange[0])/(this.componentgc.graphinfo.y.max-this.componentgc.graphinfo.y.min);for(let t=0;t<this.XS.length;t++)this.PROBS[t]*=d,this.PROBS[t]+=this.ENERGY;this.POTENTIAL=this.XS.map(t=>.5*this.KF*math.pow(t,2)*6242e-9)}clearGraphs(){this.densitygc.clear(),this.componentgc.clear()}drawGraphs(){for(let t=0;t<this.MAXCOEFFICIENTS;t++){const e=.0161538,s=(this.NS[t]+.5)*math.sqrt(this.KF/this.M)*e;this.densitygc.drawLine(this.xbounds,[s,s],hsvToRgb(0,0,0),1,[5,4]),this.densitygc.drawText(`n = ${this.NS[t]}`,.4,s+10*(this.Yrange[1]-this.Yrange[0])/this.rightGraphHeight,{color:"black",fontsize:"14"})}this.densitygc.drawLine(this.XS.slice(0,49),this.POTENTIAL.slice(0,49),hsvToRgb(240,100,100),1,[2,2]),this.densitygc.drawLine(this.XS.slice(53,this.XS.length),this.POTENTIAL.slice(53,this.POTENTIAL.length),hsvToRgb(240,100,100),1,[2,2]),this.densitygc.drawLine(this.XS,this.PROBS,hsvToRgb(0,0,0),3),this.densitygc.drawLine([this.xbounds[0],.52*this.xbounds[1]],[this.ENERGY,this.ENERGY],hsvToRgb(0,100,100),3),this.densitygc.drawLine([.63*this.xbounds[1],this.xbounds[1]],[this.ENERGY,this.ENERGY],hsvToRgb(0,100,100),3),this.densitygc.drawLine([.52*this.xbounds[1],.63*this.xbounds[1]],[this.ENERGY,this.ENERGY],hsvToRgb(0,0,100),3),this.densitygc.drawText("E",.55*this.xbounds[1],this.ENERGY+.03,{color:"red",fontsize:"14",fontstyle:"bold italic"}),this.densitygc.drawText("U(x)",-43,this.POTENTIAL[50],{color:"blue",fontsize:"14",fontstyle:"bold"}),this.componentgc.drawText("Re",.3,2.6,{color:"blue"}),this.componentgc.drawText("Im",.3,2.1,{color:"red"}),this.componentgc.drawLine([.38,.43],[2.6,2.6],hsvToRgb(220,100,100),2),this.componentgc.drawLine([.38,.43],[2.1,2.1],hsvToRgb(0,100,100),2),this.componentgc.drawLine(this.XS,this.RES,hsvToRgb(220,100,100),3),this.componentgc.drawLine(this.XS,this.IMS,hsvToRgb(0,100,100),3)}toggleRunning(){this.RUNNING?this.RUNNING=!1:(this.getCoefficients(),this.getNs(),this.getMass(),this.getKF(),this.RUNNING=!0)}resetTime(){this.RUNNING=!1,this.T=0,this.getCoefficients(),this.T-=this.TSTEP,this.update()}measureE(){this.getCoefficients();let t=[],e=[];for(let s=0;s<this.MAXCOEFFICIENTS;s++){e.push(0);const i=s>0?t[s-1]:0;t.push(i+this.scaledcoefficients[s])}const s=Math.random();for(let i=0;i<this.MAXCOEFFICIENTS;i++)if(s<t[i]){e[i]=1;break}this.scaledcoefficients=e,this.RUNNING&&this.toggleRunning(),this.T=0-this.TSTEP,this.update()}riemanntrapezoid(t,e,s,i,h=!1){let a=0;for(let o=0;o<t.length;o+=1)t[o]>=s&&t[o+1]<=i&&(a+=(e[o]+e[o+1]-2*this.ENERGY)/2*(t[o+1]-t[o]),h&&this.densitygc.fillLine([t[o],t[o],t[o+1],t[o+1]],[this.ENERGY,e[o],e[o+1],this.ENERGY],hsvToRgb(0,100,100)));return a}integrate(){this.RUNNING=!1,this.clearGraphs();const t=Number(document.getElementById("x1").value),e=Number(document.getElementById("x2").value),s=this.riemanntrapezoid(this.XS,this.PROBS,-.5,.5,!1),i=this.riemanntrapezoid(this.XS,this.PROBS,t,e,!0)/s;this.drawGraphs();const h=4;document.getElementById("int").value=Math.round(i*10**h,h)/10**h}getCoefficients(){this.coefficients=[],this.scaledcoefficients=[];let t=0;for(let e=1;e<=this.MAXCOEFFICIENTS;e++){const s=parseFloat(document.getElementById(`cn-${e}`).value);this.coefficients.push(s),this.scaledcoefficients.push(s),t+=s}this.scaledcoefficients.forEach((e,s,i)=>i[s]/=t),this.T-=this.TSTEP,this.update()}getNs(){this.NS=[];for(let t=1;t<=this.MAXCOEFFICIENTS;t++){let e=parseFloat(document.getElementById(`n-${t}`).value);e>20&&(e=20,document.getElementById(`n-${t}`).value=20),this.NS.push(e)}this.T-=this.TSTEP,this.update()}getMass(){const t=Number(math.pow(10,3*(document.getElementById("sldmass").value-1)/99-3)).toFixed(5);document.getElementById("spanmass").innerHTML=`mass: ${Number(t).toFixed(3)} Da`,this.M=t,this.T-=this.TSTEP,this.update()}getKF(){const t=Math.trunc(math.pow(10,1+2*(document.getElementById("sldkf").value-1)/99));document.getElementById("spankf").innerHTML=`force constant k<sub>f</sub>&nbsp: ${t} N/m`,this.KF=t,this.T-=this.TSTEP,this.update()}scaleBody(){scale(this.SCALE)}}window.Simulation=new Sim;