function hermites(t,e){let s={0:"1",1:`${2*e}`,2:`${4*Math.pow(e,2)-2}`,3:`${-12*e+8*Math.pow(e,3)}`,4:`${12-48*Math.pow(e,2)+16*Math.pow(e,4)}`,5:`${120*e-160*Math.pow(e,3)+32*Math.pow(e,5)}`,6:`${720*Math.pow(e,2)-120-480*Math.pow(e,4)+64*Math.pow(e,6)}`,7:`${-1680*e+3360*Math.pow(e,3)-1344*Math.pow(e,5)+128*Math.pow(e,7)}`,8:`${1680-13440*Math.pow(e,2)+13440*Math.pow(e,4)-3584*Math.pow(e,6)+256*Math.pow(e,8)}`,9:`${30240*e-80640*Math.pow(e,3)+48384*Math.pow(e,5)-9216*Math.pow(e,7)+512*Math.pow(e,9)}`,10:`${302400*Math.pow(e,2)-30240-403200*Math.pow(e,4)+161280*Math.pow(e,6)-23040*Math.pow(e,8)+1024*Math.pow(e,10)}`,11:`${-665280*e+2217600*Math.pow(e,3)-1774080*Math.pow(e,5)+506880*Math.pow(e,7)-56320*Math.pow(e,9)+2048*Math.pow(e,11)}`,12:`${665280-7983360*Math.pow(e,2)+13305600*Math.pow(e,4)-7096320*Math.pow(e,6)+1520640*Math.pow(e,8)-135168*Math.pow(e,10)+4096*Math.pow(e,12)}`,13:`${17297280*e-69189120*Math.pow(e,3)+69189120*Math.pow(e,5)-26357760*Math.pow(e,7)+4392960*Math.pow(e,9)-319488*Math.pow(e,11)+8192*Math.pow(e,13)}`,14:`${242161920*Math.pow(e,2)-17297280-484323840*Math.pow(e,4)+322882560*Math.pow(e,6)-92252160*Math.pow(e,8)+12300288*Math.pow(e,10)-745472*Math.pow(e,12)+16384*Math.pow(e,14)}`,15:`${-518918400*e+2421619200*Math.pow(e,3)-2905943040*Math.pow(e,5)+1383782400*Math.pow(e,7)-307507200*Math.pow(e,9)+33546240*Math.pow(e,11)-1720320*Math.pow(e,13)+32768*Math.pow(e,15)}`,16:`${518918400-8302694400*Math.pow(e,2)+19372953600*Math.pow(e,4)-15498362880*Math.pow(e,6)+5535129600*Math.pow(e,8)-984023040*Math.pow(e,10)+89456640*Math.pow(e,12)-3932160*Math.pow(e,14)+65536*Math.pow(e,16)}`,17:`${17643225600*e-94097203200*Math.pow(e,3)+131736084480*Math.pow(e,5)-75277762560*Math.pow(e,7)+20910489600*Math.pow(e,9)-3041525760*Math.pow(e,11)+233963520*Math.pow(e,13)-8912896*Math.pow(e,15)+131072*Math.pow(e,17)}`,18:`${317578060800*Math.pow(e,2)-17643225600-846874828800*Math.pow(e,4)+790416506880*Math.pow(e,6)-338749931520*Math.pow(e,8)+75277762560*Math.pow(e,10)-9124577280*Math.pow(e,12)+601620480*Math.pow(e,14)-20054016*Math.pow(e,16)+262144*Math.pow(e,18)}`,19:`${-670442572800*e+4022655436800*Math.pow(e,3)-6436248698880*Math.pow(e,5)+4290832465920*Math.pow(e,7)-1430277488640*Math.pow(e,9)+260050452480*Math.pow(e,11)-26671841280*Math.pow(e,13)+1524105216*Math.pow(e,15)-44826624*Math.pow(e,17)+524288*Math.pow(e,19)}`,20:`${670442572800-0xc31fdd3f000*Math.pow(e,2)+40226554368e3*Math.pow(e,4)-42908324659200*Math.pow(e,6)+21454162329600*Math.pow(e,8)-5721109954560*Math.pow(e,10)+866834841600*Math.pow(e,12)-76205260800*Math.pow(e,14)+3810263040*Math.pow(e,16)-99614720*Math.pow(e,18)+1048576*Math.pow(e,20)}`};return s[t]}import{GraphCanvas}from"../src/GraphCanvas.js";import{hsvToRgb}from"../src/hsvToRgb.js";import{linspace}from"../src/sky-helpers.js";import{Modal}from"../src/Modal.js";import{modalFill}from"../src/modalFill.js";import{scale}from"../src/scaleApp.js";class Sim{constructor(){this.defineGlobals(),this.insertPageElements(),this.attachListeners(),window.setInterval(this.nextFrame.bind(this),1e3/this.FPS),this.init()}init(){this.getCoefficients(),this.getNs(),this.getMass(),this.getKF(),this.T-=this.TSTEP,this.update();var t=[];t.push(modalFill(this.modalDetails,"../html/modalHTML/harmonicDetailsContent.html.txt")),t.push(modalFill(this.modalDirections,"../html/modalHTML/harmonicDirectionsContent.html.txt")),t.push(modalFill(this.modalAbout,"../html/modalHTML/harmonicAboutContent.html.txt"));const e=this.modalDetails,s=this.modalDirections;Promise.all(t).then(function(){MathJax.Hub.Configured()}).catch(()=>{console.log("MathJax Not Yet Loaded ...");let t=1e3;setTimeout(function i(){try{MathJax.Hub.Configured()}catch(h){console.error(h),t<1e4?(t*=1.5,setTimeout(i,t)):(modalFill(e,"../html/modalHTML/errorText.html.txt"),modalFill(s,"../html/modalHTML/errorText.html.txt"))}},t)})}defineGlobals(){this.RUNNING=!1,this.FPS=60,this.T=0,this.TSTEP=1/this.FPS,this.minMass=.1,this.maxMass=10,this.minKF=1,this.maxKF=100,this.scaleMass=100,this.scaleKF=100,this.graphWidth=420,this.graphHeight=280,this.graphLeft=30,this.graphRight=10,this.graphTop=10,this.graphBottom=50,this.xbounds=[-2,2],this.MAXCOEFFICIENTS=6,this.NS=linspace(0,this.MAXCOEFFICIENTS-1,this.MAXCOEFFICIENTS,!0),this.POINTS=501,this.XS=linspace(this.xbounds[0],this.xbounds[1],this.POINTS+1,!0),this.YS=[],this.HS=[],this.KF=10,this.M=1,this.PROBS=[],this.RES=[],this.IMS=[],this.SCALE=1,this.detailsContent="",this.directionsContent="",this.aboutContent="",this.modalDetails=new Modal({modalid:"modal-details",modalclass:"modal moveUp",headerstyle:"",header:"Details",contentstyle:"",content:this.detailsContent,showing:!1}),this.modalDirections=new Modal({modalid:"modal-directions",modalclass:"modal moveUp",headerstyle:"",header:"Directions",contentstyle:"",content:this.directionsContent,showing:!1}),this.modalAbout=new Modal({modalid:"modal-about",modalclass:"modal moveUp",headerstyle:"",header:"About",contentstyle:"",content:this.aboutContent,showing:!1})}insertPageElements(){let t='<div id="page">';t+='<div class="navbar">',t+="<div class='zoom'><img src='../../media/magPlus.png' width='30' id='zoomIn' class='buttonSmall'></img><img src='../../media/magMinus.png' width='30' id='zoomOut' class='buttonSmall'></img></div>",t+="<button id='details' class='buttonMed'>details</button>",t+="<button id='directions' class='buttonMed'>directions</button>",t+="<button id='about' class='buttonMed'>about</button>",t+="</div>",t+='<div class="row">',t+='<div id="left" class="column"></div>',t+='<div id="right" class="column"></div>',t+="</div>",t+="</div>",document.body.insertAdjacentHTML("beforeend",t),t='<div id="coefficients">',t+="<table>",t+="<th>n</th><th>C<sub>n</sub></th>";for(let e=1;e<this.MAXCOEFFICIENTS+1;e++)t+="<tr>",t+=`<td class="table dark"><input id="n-${e}" class="tableinput" value="${this.NS[e-1]}" placeholder="${e}"></input></td>`,t+=`<td class="table light"><input id="cn-${e}" class="tableinput" value="${1==e?1:0}" placeholder="0" tabindex="${e}"></input></td>`,t+="</tr>";t+="</table>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="buttons">',t+="<button id='resetc'>reset t = 0</button>",t+="<button id='reset'>reset defaults</button>",t+="<button id='togglec'>start/stop</button>",t+="<br>",t+="<button id='measure'>measure E</button>",t+="<button id='integrate'>integrate</button>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="integral">',t+="<table>",t+="<th>x<sub>1</sub></th><th>x<sub>2</sub></th><th>integral</th>",t+='<tr><td><input id="x1" class="tableinput" value="-1" placeholder="0"></input></td>',t+='<td><input id="x2" class="tableinput" value="1" placeholder="0"></input></td>',t+='<td><input id="int" class="tableinput" placeholder="-" readonly></input></td>',t+="</tr></table>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="sliders" class="row">',t+='<div class="sliderdiv">',t+='<p id="spanmass" class="sliderp">Mass</p>',t+=`<input type="range" min="${this.minMass*this.scaleMass}" max="${this.maxMass*this.scaleMass}" value="${this.M*this.scaleMass}" class="slider" id="sldmass">`,t+="</div>",t+='<div class="sliderdiv">',t+='<p id="spankf" class="sliderp">force constant k<sub>f</sub>&nbsp</p>',t+=`<input type="range" min="${this.minKF*this.scaleKF}" max="${this.maxKF*this.scaleKF}" value="${this.KF*this.scaleKF}" class="slider" id="sldkf">`,t+="</div>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t);const e={graphwidth:this.graphWidth,graphheight:2.5*this.graphHeight,padding:{left:this.graphLeft,bottom:this.graphBottom,top:this.graphTop,right:this.graphRight},graphbackground:"white",axesbackground:"white",x:{label:"x - x<sub>0</sub>",min:this.xbounds[0],max:this.xbounds[1],majortick:1,minortick:1,gridline:2},y:{label:"",min:0,max:70,majortick:10,minortick:10,gridline:70}},s={graphwidth:this.graphWidth,graphheight:this.graphHeight,padding:{left:this.graphLeft,bottom:this.graphBottom,top:this.graphTop,right:this.graphRight},graphbackground:"white",axesbackground:"white",x:{label:"x - x<sub>0</sub>",min:this.xbounds[0],max:this.xbounds[1],majortick:1,minortick:1,gridline:2},y:{label:"",min:-3,max:3,majortick:1,minortick:1,gridline:3}};document.getElementById("right").insertAdjacentHTML("beforeend",'<span class="graphtitle">Energy and Probability Density |ψ|² (=ψ*ψ)</span>'),this.densitygc=new GraphCanvas("density-gc","right",{graphinfo:e}),document.getElementById("left").insertAdjacentHTML("beforeend",'<span class="graphtitle">Real & Imaginary Components</span>'),this.componentgc=new GraphCanvas("component-gc","left",{graphinfo:s})}attachListeners(){document.getElementById("togglec").addEventListener("click",()=>this.toggleRunning()),document.getElementById("resetc").addEventListener("click",()=>this.resetTime()),document.getElementById("reset").addEventListener("click",()=>location.reload()),document.getElementById("measure").addEventListener("click",()=>this.measureE()),document.getElementById("integrate").addEventListener("click",()=>this.integrate());for(let t=1;t<=this.MAXCOEFFICIENTS;t++)document.getElementById(`n-${t}`).addEventListener("input",()=>this.getNs()),document.getElementById(`cn-${t}`).addEventListener("input",()=>this.getCoefficients());document.getElementById("sldmass").addEventListener("input",()=>this.getMass()),document.getElementById("sldkf").addEventListener("input",()=>this.getKF()),document.getElementById("details").addEventListener("click",()=>this.modalDetails.show()),document.getElementById("directions").addEventListener("click",()=>this.modalDirections.show()),document.getElementById("about").addEventListener("click",()=>this.modalAbout.show()),document.getElementById("zoomIn").addEventListener("click",()=>{this.SCALE*=1.125,this.scaleBody(this.SCALE)}),document.getElementById("zoomOut").addEventListener("click",()=>{this.SCALE/=1.125,this.scaleBody(this.SCALE)})}nextFrame(){this.RUNNING&&this.update()}update(){this.T+=this.TSTEP,this.calculatePsi(),this.clearGraphs(),this.drawGraphs()}calculatePsi(){const t=.1;this.PSI=[],this.PROBS=[],this.RES=[],this.IMS=[];const e=this.NS.map(t=>(t+.5)*math.sqrt(this.KF/this.M)),s=e.map(t=>math.exp(math.complex(0,-t*this.T))),i=math.pow(t*t/(this.M*this.KF),.25),h=this.XS.map(t=>t/i),a=h.map(t=>math.exp(-.5*math.pow(t,2)));for(let t=0;t<this.coefficients.length;t++){const e=math.divide(1,math.sqrt(math.prod(i,math.pow(2,this.NS[t]),math.factorial(this.NS[t]),math.pow(math.PI,.5))));for(let i=0;i<this.XS.length;i++){const o=h[i],n=hermites(this.NS[t],o),d=a[i];0==t?(this.PSI.push(math.prod(this.scaledcoefficients[t],e,n,d)),this.PSI[i]=math.complex(math.prod(this.PSI[i],math.re(s[t])),math.prod(this.PSI[i],math.im(s[t]))),this.PROBS.push(math.re(math.prod(this.PSI[i],math.conj(this.PSI[i])))),this.RES.push(math.re(this.PSI[i])),this.IMS.push(math.im(this.PSI[i]))):(this.PSI[i].re+=math.prod(this.scaledcoefficients[t],e,n,d,math.re(s[t])),this.PSI[i].im+=math.prod(this.scaledcoefficients[t],e,n,d,math.im(s[t])),this.RES[i]=math.re(this.PSI[i]),this.IMS[i]=math.im(this.PSI[i]),this.PROBS[i]+=math.re(math.prod(this.PSI[i],math.conj(this.PSI[i]))))}}this.ENERGY=0;for(let t=0;t<this.MAXCOEFFICIENTS;t++){const e=(this.NS[t]+.5)*math.sqrt(this.KF/this.M)*(6.62/(3.34*math.PI))*3.16*6.022*100/1e3;this.ENERGY+=e*this.scaledcoefficients[t]}for(let t=0;t<this.XS.length;t++)this.PROBS[t]+=this.ENERGY}clearGraphs(){this.densitygc.clear(),this.componentgc.clear()}drawGraphs(){for(let t=0;t<this.MAXCOEFFICIENTS;t++){const e=(this.NS[t]+.5)*math.sqrt(this.KF/this.M)*(6.62/(3.34*math.PI))*3.16*6.022*100/1e3;this.densitygc.drawLine(this.xbounds,[e,e],hsvToRgb(0,0,0),1,[3,3])}this.densitygc.drawLine(this.xbounds,[this.ENERGY,this.ENERGY],hsvToRgb(0,100,100),3),this.densitygc.drawLine(this.XS,this.PROBS,hsvToRgb(0,0,0),3),this.componentgc.drawText("Re",.93,2.8,{color:"blue"}),this.componentgc.drawText("Im",.93,2.3,{color:"red"}),this.componentgc.drawLine(this.XS,this.RES,hsvToRgb(220,100,100),3),this.componentgc.drawLine(this.XS,this.IMS,hsvToRgb(0,100,100),3)}toggleRunning(){this.RUNNING=!this.RUNNING}resetTime(){this.RUNNING=!1,this.T=0,this.getCoefficients(),this.T-=this.TSTEP,this.update()}measureE(){this.getCoefficients();let t=[],e=[];for(let s=0;s<this.MAXCOEFFICIENTS;s++){e.push(0);const i=s>0?t[s-1]:0;t.push(i+this.scaledcoefficients[s])}const s=Math.random();for(let i=0;i<this.MAXCOEFFICIENTS;i++)if(s<t[i]){e[i]=1;break}this.coefficients=e,this.update()}riemanntrapezoid(t,e,s,i,h=!1){let a=0;for(let o=0;o<t.length;o+=1)t[o]>=s&&t[o+1]<=i&&(a+=(e[o]+e[o+1]-2*this.ENERGY)/2*(t[o+1]-t[o]),h&&this.densitygc.fillLine([t[o],t[o],t[o+1],t[o+1]],[this.ENERGY,e[o],e[o+1],this.ENERGY],hsvToRgb(0,100,100)));return a}integrate(){this.RUNNING=!1,this.clearGraphs();const t=Number(document.getElementById("x1").value),e=Number(document.getElementById("x2").value),s=this.riemanntrapezoid(this.XS,this.PROBS,-2,2,!1),i=this.riemanntrapezoid(this.XS,this.PROBS,t,e,!0)/s;this.drawGraphs();const h=4;document.getElementById("int").value=Math.round(i*10**h,h)/10**h}getCoefficients(){this.coefficients=[],this.scaledcoefficients=[];let t=0;for(let e=1;e<=this.MAXCOEFFICIENTS;e++){const s=parseFloat(document.getElementById(`cn-${e}`).value);this.coefficients.push(s),this.scaledcoefficients.push(s),t+=s}this.scaledcoefficients.forEach((e,s,i)=>i[s]/=t),this.T-=this.TSTEP,this.update()}getNs(){this.NS=[];for(let t=1;t<=this.MAXCOEFFICIENTS;t++){let e=parseFloat(document.getElementById(`n-${t}`).value);e>20&&(e=20,document.getElementById(`n-${t}`).value=20),this.NS.push(e)}this.T-=this.TSTEP,this.update()}getMass(){const t=document.getElementById("sldmass").value/this.scaleMass;document.getElementById("spanmass").innerHTML=`mass: ${t}`,this.M=t,this.T-=this.TSTEP,this.update()}getKF(){const t=document.getElementById("sldkf").value/this.scaleKF;document.getElementById("spankf").innerHTML=`force constant k<sub>f</sub>&nbsp: ${t}`,this.KF=t,this.T-=this.TSTEP,this.update()}scaleBody(){scale(this.SCALE)}}window.Simulation=new Sim;