function hermites(t,s){let e={0:"1",1:`${2*s}`,2:`${4*Math.pow(s,2)-2}`,3:`${-12*s+8*Math.pow(s,3)}`,4:`${12-48*Math.pow(s,2)+16*Math.pow(s,4)}`,5:`${120*s-160*Math.pow(s,3)+32*Math.pow(s,5)}`,6:`${720*Math.pow(s,2)-120-480*Math.pow(s,4)+64*Math.pow(s,6)}`,7:`${-1680*s+3360*Math.pow(s,3)-1344*Math.pow(s,5)+128*Math.pow(s,7)}`,8:`${1680-13440*Math.pow(s,2)+13440*Math.pow(s,4)-3584*Math.pow(s,6)+256*Math.pow(s,8)}`,9:`${30240*s-80640*Math.pow(s,3)+48384*Math.pow(s,5)-9216*Math.pow(s,7)+512*Math.pow(s,9)}`,10:`${302400*Math.pow(s,2)-30240-403200*Math.pow(s,4)+161280*Math.pow(s,6)-23040*Math.pow(s,8)+1024*Math.pow(s,10)}`,11:`${-665280*s+2217600*Math.pow(s,3)-1774080*Math.pow(s,5)+506880*Math.pow(s,7)-56320*Math.pow(s,9)+2048*Math.pow(s,11)}`,12:`${665280-7983360*Math.pow(s,2)+13305600*Math.pow(s,4)-7096320*Math.pow(s,6)+1520640*Math.pow(s,8)-135168*Math.pow(s,10)+4096*Math.pow(s,12)}`,13:`${17297280*s-69189120*Math.pow(s,3)+69189120*Math.pow(s,5)-26357760*Math.pow(s,7)+4392960*Math.pow(s,9)-319488*Math.pow(s,11)+8192*Math.pow(s,13)}`,14:`${242161920*Math.pow(s,2)-17297280-484323840*Math.pow(s,4)+322882560*Math.pow(s,6)-92252160*Math.pow(s,8)+12300288*Math.pow(s,10)-745472*Math.pow(s,12)+16384*Math.pow(s,14)}`,15:`${-518918400*s+2421619200*Math.pow(s,3)-2905943040*Math.pow(s,5)+1383782400*Math.pow(s,7)-307507200*Math.pow(s,9)+33546240*Math.pow(s,11)-1720320*Math.pow(s,13)+32768*Math.pow(s,15)}`,16:`${518918400-8302694400*Math.pow(s,2)+19372953600*Math.pow(s,4)-15498362880*Math.pow(s,6)+5535129600*Math.pow(s,8)-984023040*Math.pow(s,10)+89456640*Math.pow(s,12)-3932160*Math.pow(s,14)+65536*Math.pow(s,16)}`,17:`${17643225600*s-94097203200*Math.pow(s,3)+131736084480*Math.pow(s,5)-75277762560*Math.pow(s,7)+20910489600*Math.pow(s,9)-3041525760*Math.pow(s,11)+233963520*Math.pow(s,13)-8912896*Math.pow(s,15)+131072*Math.pow(s,17)}`,18:`${317578060800*Math.pow(s,2)-17643225600-846874828800*Math.pow(s,4)+790416506880*Math.pow(s,6)-338749931520*Math.pow(s,8)+75277762560*Math.pow(s,10)-9124577280*Math.pow(s,12)+601620480*Math.pow(s,14)-20054016*Math.pow(s,16)+262144*Math.pow(s,18)}`,19:`${-670442572800*s+4022655436800*Math.pow(s,3)-6436248698880*Math.pow(s,5)+4290832465920*Math.pow(s,7)-1430277488640*Math.pow(s,9)+260050452480*Math.pow(s,11)-26671841280*Math.pow(s,13)+1524105216*Math.pow(s,15)-44826624*Math.pow(s,17)+524288*Math.pow(s,19)}`,20:`${670442572800-0xc31fdd3f000*Math.pow(s,2)+40226554368e3*Math.pow(s,4)-42908324659200*Math.pow(s,6)+21454162329600*Math.pow(s,8)-5721109954560*Math.pow(s,10)+866834841600*Math.pow(s,12)-76205260800*Math.pow(s,14)+3810263040*Math.pow(s,16)-99614720*Math.pow(s,18)+1048576*Math.pow(s,20)}`};return e[t]}import{GraphCanvas}from"../src/GraphCanvas.js";import{hsvToRgb}from"../src/hsvToRgb.js";import{linspace}from"../src/sky-helpers.js";class Sim{constructor(){this.defineGlobals(),this.insertPageElements(),this.attachListeners(),window.setInterval(this.nextFrame.bind(this),1e3/this.FPS),this.init()}init(){this.getCoefficients(),this.getNs(),this.getMass(),this.getKF(),this.T-=this.TSTEP,this.update()}defineGlobals(){this.RUNNING=!1,this.FPS=60,this.T=0,this.TSTEP=1/this.FPS,this.minMass=.1,this.maxMass=10,this.minKF=1,this.maxKF=100,this.scaleMass=100,this.scaleKF=100,this.graphWidth=420,this.graphHeight=280,this.graphLeft=30,this.graphRight=10,this.graphTop=10,this.graphBottom=50,this.xbounds=[-2,2],this.MAXCOEFFICIENTS=6,this.NS=linspace(0,this.MAXCOEFFICIENTS-1,this.MAXCOEFFICIENTS,!0),this.POINTS=201,this.XS=linspace(this.xbounds[0],this.xbounds[1],this.POINTS+1,!0),this.YS=[],this.HS=[],this.KF=10,this.M=1,this.PROBS=[],this.RES=[],this.IMS=[]}insertPageElements(){let t='<div id="page">';t+='<div class="row">',t+='<div id="left" class="column"></div>',t+='<div id="right" class="column"></div>',t+="</div>",t+="</div>",document.body.insertAdjacentHTML("beforeend",t),t='<div id="coefficients">',t+="<table>",t+="<th>n</th><th>C<sub>n</sub></th>";for(let s=1;s<this.MAXCOEFFICIENTS+1;s++)t+="<tr>",t+=`<td class="table dark"><input id="n-${s}" class="tableinput" value="${this.NS[s-1]}" placeholder="${s}"></input></td>`,t+=`<td class="table light"><input id="cn-${s}" class="tableinput" value="${1==s?1:0}" placeholder="0" tabindex="${s}"></input></td>`,t+="</tr>";t+="</table>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="buttons">',t+="<button id='resetc'>reset t = 0</button>",t+="<button id='reset'>reset defaults</button>",t+="<button id='togglec'>start/stop</button>",t+="<br>",t+="<button id='measure'>measure E</button>",t+="<button id='integrate'>integrate</button>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="integral">',t+="<table>",t+="<th>x<sub>1</sub></th><th>x<sub>2</sub></th><th>integral</th>",t+='<tr><td><input id="x1" class="tableinput" value="-1" placeholder="0"></input></td>',t+='<td><input id="x2" class="tableinput" value="1" placeholder="0"></input></td>',t+='<td><input id="int" class="tableinput" placeholder="-" readonly></input></td>',t+="</tr></table>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t),t='<div id="sliders" class="row">',t+='<div class="sliderdiv">',t+='<p id="spanmass" class="sliderp">Mass</p>',t+=`<input type="range" min="${this.minMass*this.scaleMass}" max="${this.maxMass*this.scaleMass}" value="${this.M*this.scaleMass}" class="slider" id="sldmass">`,t+="</div>",t+='<div class="sliderdiv">',t+='<p id="spankf" class="sliderp">force constant k<sub>f</sub>&nbsp</p>',t+=`<input type="range" min="${this.minKF*this.scaleKF}" max="${this.maxKF*this.scaleKF}" value="${this.KF*this.scaleKF}" class="slider" id="sldkf">`,t+="</div>",t+="</div>",document.getElementById("left").insertAdjacentHTML("beforeend",t);const s={graphwidth:this.graphWidth,graphheight:2.5*this.graphHeight,padding:{left:this.graphLeft,bottom:this.graphBottom,top:this.graphTop,right:this.graphRight},graphbackground:"white",axesbackground:"white",x:{label:"x - x<sub>0</sub>",min:this.xbounds[0],max:this.xbounds[1],majortick:1,minortick:1,gridline:2},y:{label:"",min:0,max:70,majortick:10,minortick:10,gridline:70}},e={graphwidth:this.graphWidth,graphheight:this.graphHeight,padding:{left:this.graphLeft,bottom:this.graphBottom,top:this.graphTop,right:this.graphRight},graphbackground:"white",axesbackground:"white",x:{label:"x - x<sub>0</sub>",min:this.xbounds[0],max:this.xbounds[1],majortick:1,minortick:1,gridline:2},y:{label:"",min:-3,max:3,majortick:1,minortick:1,gridline:3}};document.getElementById("right").insertAdjacentHTML("beforeend",'<span class="graphtitle">Energy and Probability Density |ψ|² (=ψ*ψ)</span>'),this.densitygc=new GraphCanvas("density-gc","right",{graphinfo:s}),document.getElementById("left").insertAdjacentHTML("beforeend",'<span class="graphtitle">Real & Imaginary Components</span>'),this.componentgc=new GraphCanvas("component-gc","left",{graphinfo:e})}attachListeners(){document.getElementById("togglec").addEventListener("click",()=>this.toggleRunning()),document.getElementById("resetc").addEventListener("click",()=>this.resetTime()),document.getElementById("reset").addEventListener("click",()=>location.reload()),document.getElementById("measure").addEventListener("click",()=>this.measureE()),document.getElementById("integrate").addEventListener("click",()=>this.integrate());for(let t=1;t<=this.MAXCOEFFICIENTS;t++)document.getElementById(`n-${t}`).addEventListener("input",()=>this.getNs()),document.getElementById(`cn-${t}`).addEventListener("input",()=>this.getCoefficients());document.getElementById("sldmass").addEventListener("input",()=>this.getMass()),document.getElementById("sldkf").addEventListener("input",()=>this.getKF())}nextFrame(){this.RUNNING&&this.update()}update(){this.T+=this.TSTEP,this.calculatePsi(),this.clearGraphs(),this.drawGraphs()}calculatePsi(){const t=.1;this.PSI=[],this.PROBS=[],this.RES=[],this.IMS=[];const s=this.NS.map(t=>(t+.5)*math.sqrt(this.KF/this.M)),e=s.map(t=>math.exp(math.complex(0,-t*this.T))),i=math.pow(t*t/(this.M*this.KF),.25),h=this.XS.map(t=>t/i),a=h.map(t=>math.exp(-.5*math.pow(t,2)));for(let t=0;t<this.coefficients.length;t++){const s=math.divide(1,math.sqrt(math.prod(i,math.pow(2,this.NS[t]),math.factorial(this.NS[t]),math.pow(math.PI,.5))));for(let i=0;i<this.XS.length;i++){const n=h[i],o=hermites(this.NS[t],n),p=a[i];0==t?(this.PSI.push(math.prod(this.scaledcoefficients[t],s,o,p)),this.PSI[i]=math.complex(math.prod(this.PSI[i],math.re(e[t])),math.prod(this.PSI[i],math.im(e[t]))),this.PROBS.push(math.re(math.prod(this.PSI[i],math.conj(this.PSI[i])))),this.RES.push(math.re(this.PSI[i])),this.IMS.push(math.im(this.PSI[i]))):(this.PSI[i].re+=math.prod(this.scaledcoefficients[t],s,o,p,math.re(e[t])),this.PSI[i].im+=math.prod(this.scaledcoefficients[t],s,o,p,math.im(e[t])),this.RES[i]=math.re(this.PSI[i]),this.IMS[i]=math.im(this.PSI[i]),this.PROBS[i]+=math.re(math.prod(this.PSI[i],math.conj(this.PSI[i]))))}}this.ENERGY=0;for(let t=0;t<this.MAXCOEFFICIENTS;t++){const s=(this.NS[t]+.5)*math.sqrt(this.KF/this.M)*(6.62/(3.34*math.PI))*3.16*6.022*100/1e3;this.ENERGY+=s*this.scaledcoefficients[t]}for(let t=0;t<this.XS.length;t++)this.PROBS[t]+=this.ENERGY}clearGraphs(){this.densitygc.clear(),this.componentgc.clear()}drawGraphs(){for(let t=0;t<this.MAXCOEFFICIENTS;t++){const s=(this.NS[t]+.5)*math.sqrt(this.KF/this.M)*(6.62/(3.34*math.PI))*3.16*6.022*100/1e3;this.densitygc.drawLine(this.xbounds,[s,s],hsvToRgb(0,0,0),1,[3,3])}this.densitygc.drawLine(this.xbounds,[this.ENERGY,this.ENERGY],hsvToRgb(0,100,100),3),this.densitygc.drawLine(this.XS,this.PROBS,hsvToRgb(0,0,0),3),this.componentgc.drawText("Re",.93,2.8,{color:"blue"}),this.componentgc.drawText("Im",.93,2.3,{color:"red"}),this.componentgc.drawLine(this.XS,this.RES,hsvToRgb(220,100,100),3),this.componentgc.drawLine(this.XS,this.IMS,hsvToRgb(0,100,100),3)}toggleRunning(){this.RUNNING=!this.RUNNING}resetTime(){this.RUNNING=!1,this.T=0,this.getCoefficients(),this.update()}measureE(){this.getCoefficients();let t=[],s=[];for(let e=0;e<this.MAXCOEFFICIENTS;e++){s.push(0);const i=e>0?t[e-1]:0;t.push(i+this.scaledcoefficients[e])}const e=Math.random();for(let i=0;i<this.MAXCOEFFICIENTS;i++)if(e<t[i]){s[i]=1;break}this.coefficients=s,this.update()}riemanntrapezoid(t,s,e,i,h=!1){let a=0;for(let n=0;n<t.length;n+=1)t[n]>=e&&t[n+1]<=i&&(a+=(s[n]+s[n+1]-2*this.ENERGY)/2*(t[n+1]-t[n]),h&&this.densitygc.fillLine([t[n],t[n],t[n+1],t[n+1]],[this.ENERGY,s[n],s[n+1],this.ENERGY],hsvToRgb(0,100,100)));return a}integrate(){this.RUNNING=!1,this.clearGraphs();const t=Number(document.getElementById("x1").value),s=Number(document.getElementById("x2").value),e=this.riemanntrapezoid(this.XS,this.PROBS,-2,2,!1),i=this.riemanntrapezoid(this.XS,this.PROBS,t,s,!0)/e;this.drawGraphs();const h=4;document.getElementById("int").value=Math.round(i*10**h,h)/10**h}getCoefficients(){this.coefficients=[],this.scaledcoefficients=[];let t=0;for(let s=1;s<=this.MAXCOEFFICIENTS;s++){const e=parseFloat(document.getElementById(`cn-${s}`).value);this.coefficients.push(e),this.scaledcoefficients.push(e),t+=e}this.scaledcoefficients.forEach((s,e,i)=>i[e]/=t),this.T-=this.TSTEP,this.update()}getNs(){this.NS=[];for(let t=1;t<=this.MAXCOEFFICIENTS;t++){let s=parseFloat(document.getElementById(`n-${t}`).value);s>20&&(s=20,document.getElementById(`n-${t}`).value=20),this.NS.push(s)}this.T-=this.TSTEP,this.update()}getMass(){const t=document.getElementById("sldmass").value/this.scaleMass;document.getElementById("spanmass").innerHTML=`mass: ${t}`,this.M=t,this.T-=this.TSTEP,this.update()}getKF(){const t=document.getElementById("sldkf").value/this.scaleKF;document.getElementById("spankf").innerHTML=`force constant k<sub>f</sub>&nbsp: ${t}`,this.KF=t,this.T-=this.TSTEP,this.update()}}window.Simulation=new Sim;